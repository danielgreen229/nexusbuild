import{_ as G,r as c,R as J,S as Q,D as X,E as I,M as l,K as S,c as d,o as v,a as t,b as Y,v as y,t as o,x as U,d as u,I as $,F as Z,U as ee}from"./C8OgziG3.js";import{u as te}from"./CM6ehZi7.js";const ae={class:"buy__container"},se={class:"wrapper"},ne={class:"card card__container"},le={class:"card__left"},oe={class:"title"},ie={class:"extras"},re={class:"addon"},ue={class:"addon"},ce={key:0,class:"preview-link"},de=["href"],ve={class:"card__right"},pe={class:"meta"},me={class:"price"},be={class:"card sidebar"},fe={class:"order-lines"},ge={class:"line"},_e={key:0,class:"line"},he={key:1,class:"line"},ye={class:"line"},xe={key:2,class:"line discount"},Ne={class:"line total"},ke={class:"order-actions"},Pe={class:"input"},we={class:"readonly-field","aria-live":"polite"},Ce={class:"input"},ze={class:"readonly-field","aria-live":"polite"},Re={class:"input"},Me={class:"readonly-field","aria-live":"polite"},De={key:1,class:"login-row"},Ie=["disabled"],Se={class:"note","aria-live":"polite"},Ue={__name:"[id]",setup($e){c([{label:"Главная",to:"/"},{label:"Шаблоны",to:"/templates"}]);const B=J(),L=Q(),R=te(),p=X(),V=c(!1);c(!1);const f=c(!1),x=c(!1),M=B.params.id;I(async()=>{if(M)try{await R.getTemplateById(M)}catch{}if(typeof p.init=="function")try{await p.init()}catch{}});function O(){x.value=!1,f.value=!0}function T(){x.value=!0,f.value=!0}function A(a){f.value=!1,V.value=!1}function D(a){window.open(a,"_blank","noopener,noreferrer")}const n=l(()=>R.current||{id:null,title:"",price:0,image:"",description:"",features:[],pages:[],technologies:[],screenshots:[],preview:"",discount_percent:0,discount_amount:0}),N=l(()=>Number(n.value.price||0)),s=c({extraPage:{enabled:!1,price:1e3,count:0},customization:{enabled:!1,pricePerHour:500,hours:0},priority:{enabled:!1,price:1e3},hosting:{enabled:!1,price:1e3}}),m=c([]);I(()=>{n.value.pages&&n.value.pages.length&&(m.value=[...n.value.pages])}),S(()=>n.value.pages,a=>{a&&m.value.length===0&&(m.value=[...a])});const k=c({name:"",contact:""}),g=c(!1);l(()=>m.value.length);const E=l(()=>{const a=Number(s.value.extraPage.count||0),e=Number(s.value.extraPage.price||0);return s.value.extraPage.enabled&&a>0?a*e:0}),F=l(()=>{const a=Number(s.value.customization.hours||0),e=Number(s.value.customization.pricePerHour||0);return s.value.customization.enabled&&a>0?a*e:0}),H=l(()=>s.value.priority.enabled?Number(s.value.priority.price||0):0),W=l(()=>s.value.hosting.enabled?Number(s.value.hosting.price||0):0),b=l(()=>[N.value,E.value,F.value,H.value,W.value].reduce((e,r)=>e+Number(r||0),0)),_=l(()=>{const a=Number(n.value.discount_amount||0),e=Number(n.value.discount_percent||0);return a>0?Math.min(a,b.value):e>0?Math.min(Math.round(b.value*e/100),b.value):0}),K=l(()=>{const a=Number(n.value.discount_amount||0),e=Number(n.value.discount_percent||0);return a>0?`${i(a)}`:e>0?`${e}%`:""}),P=l(()=>{const a=b.value-_.value;return a>0?a:0});function i(a){try{const e=Number(a||0);return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",maximumFractionDigits:0}).format(Math.round(e))}catch{return`${a} ₽`}}function j(){s.value.extraPage.enabled=!1,s.value.extraPage.count=0,s.value.customization.enabled=!1,s.value.customization.hours=0,s.value.priority.enabled=!1,s.value.hosting.enabled=!1,m.value=n.value.pages?[...n.value.pages]:[],k.value={name:"",contact:""}}async function q(){if(!h.value){L.push({path:"/login"});return}const a={name:w.value||"",contact:C.value||""};g.value=!0;try{const e={templateId:n.value.id,templateTitle:n.value.title,basePrice:N.value,extras:{extraPages:s.value.extraPage.enabled?{count:s.value.extraPage.count,unitPrice:s.value.extraPage.price}:null,customization:s.value.customization.enabled?{hours:s.value.customization.hours,rate:s.value.customization.pricePerHour}:null,priority:s.value.priority.enabled?{price:s.value.priority.price}:null,hosting:s.value.hosting.enabled?{price:s.value.hosting.price}:null},subtotal:b.value,discount:_.value,total:P.value,buyer:a,selectedPages:m.value,created_at:new Date().toISOString()};console.log("ORDER",e),alert(`Заявка отправлена!
Итог: `+i(P.value)),j()}catch(e){console.error(e),alert("Ошибка при оформлении заказа")}finally{g.value=!1}}const h=l(()=>!!p.isAuthenticated),w=l(()=>{const a=p.user||{};if(a.name)return a.name;const e=a.firstName||a.first_name||"",r=a.lastName||a.last_name||"";return`${e} ${r}`.trim()||""}),C=l(()=>{const a=p.user||{};return a.email||a.email_address||a.phone||a.telephone||a.mobile||""}),z=l(()=>p.user||{});return S(h,a=>{a&&(w.value&&(k.value.name=w.value),C.value&&(k.value.contact=C.value))}),(a,e)=>(v(),d("div",ae,[t("div",se,[t("section",ne,[t("div",le,[t("h1",oe,'Сайт "'+o(n.value.title)+'"',1),t("div",ie,[e[5]||(e[5]=t("h3",null,"Дополнительные опции",-1)),t("label",re,[U(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=r=>s.value.priority.enabled=r)},null,512),[[$,s.value.priority.enabled]]),u(" Приоритетная доработка — "+o(i(s.value.priority.price)),1)]),t("label",ue,[U(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=r=>s.value.hosting.enabled=r)},null,512),[[$,s.value.hosting.enabled]]),u(" Подключение и хостинг — "+o(i(s.value.hosting.price)),1)])]),n.value.preview?(v(),d("div",ce,[t("a",{href:n.value.preview,target:"_blank",rel:"noopener"},"Открыть демо (preview)",8,de)])):y("",!0)]),t("div",ve,[t("div",pe,[t("span",me,o(i(n.value.price)),1)])])]),t("aside",be,[e[20]||(e[20]=t("h2",null,"Ваш заказ",-1)),t("div",fe,[t("div",ge,[e[6]||(e[6]=t("span",null,"Базовая цена",-1)),t("span",null,o(i(N.value)),1)]),s.value.priority.enabled?(v(),d("div",_e,[e[7]||(e[7]=t("span",null,"Приоритет",-1)),t("span",null,o(i(s.value.priority.price)),1)])):y("",!0),s.value.hosting.enabled?(v(),d("div",he,[e[8]||(e[8]=t("span",null,"Подключение / хостинг",-1)),t("span",null,o(i(s.value.hosting.price)),1)])):y("",!0),e[11]||(e[11]=t("hr",null,null,-1)),t("div",ye,[e[9]||(e[9]=t("strong",null,"Промежуточная сумма",-1)),t("strong",null,o(i(b.value)),1)]),_.value>0?(v(),d("div",xe,[t("span",null,"Скидка "+o(K.value),1),t("span",null,"-"+o(i(_.value)),1)])):y("",!0),t("div",Ne,[e[10]||(e[10]=t("strong",null,"Итого",-1)),t("strong",null,o(i(P.value)),1)])]),t("div",ke,[h.value?(v(),d(Z,{key:0},[t("label",Pe,[e[12]||(e[12]=u(" ФИО: ")),t("div",we,o(z.value.fullname||"—"),1)]),t("label",Ce,[e[13]||(e[13]=u(" Телефон: ")),t("div",ze,o(z.value.phone||"—"),1)]),t("label",Re,[e[14]||(e[14]=u(" Почта: ")),t("div",Me,o(z.value.email||"—"),1)])],64)):(v(),d("div",De,[e[15]||(e[15]=u(" Необходимо ")),t("button",{class:"btn-link",onClick:O},"Войти"),e[16]||(e[16]=u(" или ")),t("button",{class:"btn-link",onClick:T},"Зарегистрироваться")])),t("button",{class:"btn primary",disabled:g.value||!h.value,onClick:q},o(g.value?"Оформление…":"Оформить заказ"),9,Ie),t("div",Se,[t("small",null,[e[17]||(e[17]=u(" Нажимая «Оформить заказ», вы соглашаетесь с ")),t("a",{onClick:e[2]||(e[2]=r=>D("/terms"))},"условиями оферты"),e[18]||(e[18]=u(" и ")),t("a",{onClick:e[3]||(e[3]=r=>D("/privacy"))},"политикой конфиденциальности"),e[19]||(e[19]=u(". "))])])])])]),Y(ee,{visible:f.value,"onUpdate:visible":e[4]||(e[4]=r=>f.value=r),onLogin:A,startWithRegister:x.value},null,8,["visible","startWithRegister"])]))}},Oe=G(Ue,[["__scopeId","data-v-9ec88fa5"]]);export{Oe as default};
