import{_ as R,k,l as ae,M as Y,c as o,o as r,a as i,f as L,t as b,z as ee,i as me,v as pe,P as _e,y as v,d as U,F as H,j as G,n as re,U as ve,J as fe,E as C,p as te,b as O,w as le,m as ne,S as he,G as Q,g as ye,V as ge,W as be}from"./D_JQTfwH.js";import{u as ce}from"./BSKtGGBX.js";import we from"./D9Z7Ux7c.js";import{u as ke}from"./DKV5EW87.js";const $e={class:"portfolio-hero"},Fe={class:"portfolio-hero__container container"},Pe={class:"portfolio-hero__content"},xe={class:"search-wrap"},Ee=["onKeyup"],Se=["disabled"],Te={key:0},Le={key:1},Me={key:0,class:"portfolio-hero__meta"},Ae={key:0,class:"meta-count"},Ie={key:1,class:"meta-loading"},Ne={key:2,class:"meta-error"},Ce="Выберите подходящий шаблон",Oe="",ze=300,He={__name:"PortfolioHero",setup(c){const s=ce(),a=k(""),u=k(null);ae(async()=>{try{await s.listTemplates({page:1,perPage:12,filters:{}})}catch{}}),Y(a,d=>{u.value&&clearTimeout(u.value),u.value=setTimeout(async()=>{if(!d||String(d).trim()===""){await s.listTemplates({page:1,perPage:12,filters:{}});return}try{await s.listTemplates({page:1,perPage:12,filters:{search:d}})}catch{}},ze)});async function p(){u.value&&(clearTimeout(u.value),u.value=null);try{await s.listTemplates({page:1,perPage:12,filters:{search:a.value}})}catch{}}return(d,y)=>(r(),o("section",$e,[i("div",Fe,[i("div",Pe,[i("h1",{class:"portfolio-hero__title"},b(Ce)),i("p",{class:"portfolio-hero__subtitle"},b(Oe)),i("form",{class:"portfolio-hero__search",onSubmit:ee(p,["prevent"]),"aria-label":"Поиск шаблонов"},[i("div",xe,[me(i("input",{"onUpdate:modelValue":y[0]||(y[0]=$=>a.value=$),onKeyup:_e(ee(p,["prevent"]),["enter"]),type:"search",placeholder:"Найти шаблон...",class:"portfolio-hero__input","aria-label":"Поиск шаблонов"},null,40,Ee),[[pe,a.value]]),i("button",{type:"submit",class:"btn-search",disabled:v(s).loading},[v(s).loading?(r(),o("span",Te,"Поиск...")):(r(),o("span",Le,"Найти"))],8,Se)])],32),v(s).templates&&v(s).templates.length>=0?(r(),o("div",Me,[v(s).total&&v(s).templates.length>0?(r(),o("span",Ae,[y[1]||(y[1]=U(" Найдено: ")),i("strong",null,b(v(s).total??v(s).templates.length),1)])):L("",!0),v(s).loading?(r(),o("span",Ie," · загружается…")):L("",!0),v(s).error?(r(),o("span",Ne," · Ошибка: "+b(v(s).error),1)):L("",!0)])):L("",!0)])])]))}},Re=R(He,[["__scopeId","data-v-494953f4"]]),qe={class:"portfolio-filters"},Be={class:"portfolio-filters__container container"},De={class:"portfolio-filters__wrapper"},je=["onClick"],Ve={__name:"PortfolioFilters",props:{activeFilter:{type:String,required:!0}},emits:["update:activeFilter"],setup(c,{emit:s}){const a=s,u=k([{id:"all",name:"Все шаблоны"}]),p=d=>{a("update:activeFilter",d)};return(d,y)=>(r(),o("section",qe,[i("div",Be,[i("div",De,[(r(!0),o(H,null,G(v(u),$=>(r(),o("button",{key:$.id,class:re(["portfolio-filters__button",{"portfolio-filters__button--active":c.activeFilter===$.id}]),onClick:M=>p($.id)},b($.name),11,je))),128))])])]))}},Ue=R(Ve,[["__scopeId","data-v-f61ec0aa"]]),Ge={__name:"Button",props:{variant:{type:String,default:"primary",validator:c=>["primary","outline"].includes(c)},size:{type:String,default:"md",validator:c=>["sm","md","lg"].includes(c)}},setup(c){return(s,a)=>(r(),o("button",{class:re(["button",`button--${c.variant}`,`button--${c.size}`])},[ve(s.$slots,"default",{},void 0,!0)],2))}},We=R(Ge,[["__scopeId","data-v-62a209ae"]]),Ye={class:"template-card",role:"group",tabindex:"0"},Xe=["src","alt"],Ke={class:"template-card__badges"},Je={key:0,class:"template-card__badge template-card__badge--custom"},Ze={key:1,class:"template-card__badge template-card__badge--popular"},Qe={class:"template-card__content"},et={class:"template-card__header"},tt={class:"template-card__title"},nt={class:"template-card__price","aria-live":"polite"},at={key:0,style:{"text-align":"right"}},st={style:{"font-size":"0.9rem",color:"#64748b","text-decoration":"line-through"}},it={style:{"font-size":"1.2rem","font-weight":"700",color:"#f97315"}},ot={style:{"font-size":"0.8rem",color:"#065f46"}},rt={key:0},lt={class:"template-card__description"},ct={class:"template-card__features"},ut=40,j="0%",dt={__name:"TemplateCard",props:{template:{type:Object,required:!0}},emits:["view"],setup(c,{emit:s}){const a=c,u=s;fe();const p=k(!1),d=e=>{const t=Number(e)||0;return Math.round((t+Number.EPSILON)*100)/100},y=e=>{const t=Number(e)||0;return t.toLocaleString("ru-RU",{minimumFractionDigits:t%1===0?0:2,maximumFractionDigits:2})},$=C(()=>{var t,l;const e=((t=a.template)==null?void 0:t.have_html)??((l=a.template)==null?void 0:l.haveHtml);return typeof e<"u"?!!e:typeof window<"u"?!!(window!=null&&window.have_html):!1}),M=C(()=>d(a.template.price??a.template.price_cents??0)),A=C(()=>{const e=a.template.discount_percent??a.template.discountPercent??a.template.discount??0;return Number.isFinite(Number(e))?d(Number(e)):0}),q=C(()=>d(a.template.discount_amount??a.template.discountAmount??a.template.discount_amount_cents??0)),B=C(()=>q.value>0?d(q.value):A.value>0?d(M.value*A.value/100):0),X=C(()=>{const e=M.value-B.value;return d(e>0?e:0)}),K=async e=>{await he({path:"/buy-template/"+e})},W=(e,t)=>{u("view",a.template),e&&window.open(e,"_blank","noopener,noreferrer")},w=k(null),x=k(null);let h=null,_=0,F=0,E=1,g=0,I=!1,T=!1;const S={x:null,y:null},n=()=>{const e=w.value,t=x.value;if(!e||!t){g=0;return}const l=e.naturalWidth||e.width,P=e.naturalHeight||e.height,oe=t.clientWidth,Z=t.clientHeight;if(!l||!P||!oe||!Z){g=0;return}const ue=Math.max(oe/l,Z/P),de=P*ue;g=Math.max(0,Math.round(de-Z)),g<=0&&(F=0,e.style.objectPosition=`${j} 0%`,e.style.transform="")},m=e=>{const t=w.value;if(t)if(g>0){const l=Math.min(100,Math.max(0,e/g*100));t.style.objectPosition=`${j} ${l}%`}else t.style.objectPosition=`${j} 0%`,t.style.transform=""},f=e=>{if(!I)return;if(T){h=requestAnimationFrame(f);return}_||(_=e);const t=e-_;_=e;const l=ut*t/1e3*E;let P=F+l;P>=g?(P=g,E=-1):P<=0&&(P=0,E=1),F=P,m(F),h=requestAnimationFrame(f)},N=()=>{try{if(!x.value||S.x==null)return!1;const t=document.elementFromPoint(S.x,S.y);if(!t)return!1;const l=t.closest&&t.closest('button, a, input, textarea, [role="button"], label');return!(!l||l.classList&&l.classList.contains("template-card__view-button"))}catch{return!1}},z=e=>{S.x=e.clientX,S.y=e.clientY;const t=N();t&&I&&!T?T=!0:!t&&T&&(T=!1,_=0)},D=async e=>{e&&e.clientX!=null&&(S.x=e.clientX,S.y=e.clientY),await ne(),n();const t=w.value;if(g<=0){if(t&&!t.complete){const l=()=>{t.removeEventListener("load",l),n(),g>0&&x.value&&x.value.matches(":hover")&&requestAnimationFrame(()=>D())};t.addEventListener("load",l,{once:!0})}return}t&&(t._tmpl_return_end&&(t.removeEventListener("transitionend",t._tmpl_return_end),t._tmpl_return_end=null),t.style.transition="none"),F=0,E=1,m(0),T=N(),h&&cancelAnimationFrame(h),I=!0,_=0,h=requestAnimationFrame(f)},J=()=>{I=!1,T=!1,h&&(cancelAnimationFrame(h),h=null);const e=w.value;if(!e)return;if(F===0){e.style.transition="",e.style.willChange="",F=0,E=1,_=0;return}e.style.transition="object-position 600ms cubic-bezier(.22,.9,.35,1), transform 600ms cubic-bezier(.22,.9,.35,1)",e.style.objectPosition=`${j} 0%`,e.style.transform="",e._tmpl_return_end&&e.removeEventListener("transitionend",e._tmpl_return_end);const t=l=>{(!l.propertyName||l.propertyName.includes("object")||l.propertyName.includes("transform"))&&(e.style.transition="",e.style.willChange="",F=0,E=1,_=0,e.removeEventListener("transitionend",t),e._tmpl_return_end=null)};e._tmpl_return_end=t,e.addEventListener("transitionend",t)},se=e=>D(e),ie=()=>J();return ae(()=>{const e=w.value,t=x.value;e&&(e.style.objectPosition=`${j} 0%`,e.style.willChange="object-position",e.complete?n():e.addEventListener("load",n)),t&&(t.addEventListener("pointerenter",se),t.addEventListener("pointerleave",ie),t.addEventListener("pointermove",z)),window.addEventListener("resize",n)}),te(()=>{h&&cancelAnimationFrame(h);const e=w.value,t=x.value;e&&e.removeEventListener("load",n),t&&(t.removeEventListener("pointerenter",se),t.removeEventListener("pointerleave",ie),t.removeEventListener("pointermove",z)),window.removeEventListener("resize",n)}),(e,t)=>(r(),o("div",Ye,[i("div",{class:"template-card__image",ref_key:"imageWrapperRef",ref:x},[i("img",{ref_key:"imageRef",ref:w,src:c.template.preview,alt:c.template.title,loading:"lazy",draggable:"false"},null,8,Xe),i("div",Ke,[$.value?L("",!0):(r(),o("div",Je,"Заказной")),c.template.popular?(r(),o("div",Ze,"Популярный")):L("",!0)]),i("button",{class:"template-card__view-button",type:"button","aria-label":"Просмотреть шаблон",onClick:t[0]||(t[0]=ee(l=>W(c.template.preview),["stop"]))},[t[2]||(t[2]=U(" Просмотреть ")),O(v(we),{class:"open-next__svg"})])],512),i("div",Qe,[i("div",et,[i("h3",tt,b(c.template.title),1),i("div",nt,[B.value>0?(r(),o("div",at,[i("div",st,b(y(M.value))+" ₽",1),i("div",it,b(y(X.value))+" ₽",1),i("div",ot,[t[3]||(t[3]=U("Скидка: ")),A.value>0?(r(),o("span",rt,b(A.value)+"%",1)):L("",!0)])])):(r(),o(H,{key:1},[U(b(y(M.value))+" ₽",1)],64))])]),i("p",lt,b(c.template.description),1),i("div",ct,[(r(!0),o(H,null,G(c.template.features,(l,P)=>(r(),o("span",{key:P,class:"template-card__feature"},b(l),1))),128))]),O(We,{class:"template-card__button button button--primary",disabled:p.value,onClick:t[1]||(t[1]=l=>K(c.template.id))},{default:le(()=>[U(b(p.value?"Покупка...":"Купить шаблон"),1)]),_:1},8,["disabled"])])]))}},mt=R(dt,[["__scopeId","data-v-4622e1c4"]]),pt=["aria-busy"],_t={class:"portfolio-grid__container container"},vt={key:0,class:"portfolio-grid__content"},ft={key:1,class:"portfolio-grid__empty"},ht={key:2,class:"portfolio-grid__content"},yt={key:0,class:"portfolio-grid__loading"},V=12,gt="have_html,popular,created_at",bt="desc",wt={__name:"PortfolioGrid",props:{activeFilter:{type:String,required:!0}},setup(c){const s=c,a=ce();k([{id:"all",name:"Все шаблоны"}]);const u=k(null);let p=null;const d=k(!1),y=C(()=>a.loading&&a.templates.length===0),$=k(240);function M(){const n={};return s.activeFilter&&s.activeFilter!=="all"&&(n.type=s.activeFilter),n}async function A(){await ne();try{const n=document.querySelector(".portfolio-grid__content .grid-item");n&&n.offsetHeight&&($.value=n.offsetHeight)}catch{}}async function q({page:n=1,perPage:m=V,filters:f={},append:N=!1}={}){const z={...f};return a.listTemplates({page:n,perPage:m,filters:z,append:N,sortBy:gt,order:bt})}async function B(){try{a.perPage=V;const n=M();await q({page:1,perPage:V,filters:n,append:!1}),await A()}catch(n){console.error("Ошибка загрузки шаблонов:",n)}}async function X(){if(!(a.loading||d.value)&&a.hasMore){d.value=!0,await A();try{const n=M(),m=(Number(a.page)||1)+1;await q({page:m,perPage:V,filters:n,append:!0}),await A()}catch(n){console.warn("Ошибка подгрузки следующей страницы:",n)}finally{d.value=!1}}}const K=n=>{for(const m of n)m.isIntersecting&&X()};function W(){if(p){try{u.value&&p.unobserve(u.value),p.disconnect()}catch{}p=null}p=new IntersectionObserver(K,{root:null,rootMargin:"300px",threshold:.1}),ne(()=>{u.value&&p.observe(u.value)})}ae(async()=>{await B(),W()}),te(()=>{if(p){try{u.value&&p.unobserve(u.value),p.disconnect()}catch{}p=null}}),Y(()=>s.activeFilter,async()=>{await B(),W()});const w=C(()=>{const n=a.templates||[];return s.activeFilter==="all"?n:n.filter(m=>String(m.type)===String(s.activeFilter))}),x=k(V),h=k(0);let _=null,F=0,E=0,g=0,I=600;const T=n=>1-Math.pow(1-n,3);function S(n,m=I){_!==null&&(cancelAnimationFrame(_),_=null),F=performance.now(),E=h.value,g=n,I=m;const f=N=>{const z=N-F,D=Math.min(1,z/I),J=T(D);h.value=Math.round(E+(g-E)*J),D<1?_=requestAnimationFrame(f):(_=null,h.value=g)};_=requestAnimationFrame(f)}return te(()=>{_!==null&&(cancelAnimationFrame(_),_=null)}),h.value=a.loading?0:w.value.length,Y(()=>w.value.length,n=>{a.loading||S(n)}),Y(()=>a.loading,(n,m)=>{m===!0&&n===!1&&S(w.value.length)}),(n,m)=>(r(),o("section",{class:"portfolio-grid","aria-busy":y.value?"true":"false"},[i("div",_t,[m[2]||(m[2]=i("div",{class:"portfolio-grid__header"},null,-1)),y.value?(r(),o("div",vt,[(r(!0),o(H,null,G(x.value,f=>(r(),o("div",{key:"skeleton-init-"+f,class:"skeleton-card",role:"status","aria-label":"Загрузка шаблона",style:Q({minHeight:$.value+"px"})},m[0]||(m[0]=[ye('<div class="skeleton-card__thumb shimmer" data-v-e116ba3a></div><div class="skeleton-card__body" data-v-e116ba3a><div class="skeleton-line skeleton-line--title shimmer" data-v-e116ba3a></div><div class="skeleton-line skeleton-line--meta shimmer" data-v-e116ba3a></div><div class="skeleton-line skeleton-line--meta short shimmer" data-v-e116ba3a></div></div>',2)]),4))),128))])):v(a).error?(r(),o("div",ft," Ошибка: "+b(v(a).error),1)):(r(),o("div",ht,[O(ge,{name:"grid",tag:"div",class:"portfolio-grid__content-inner"},{default:le(()=>[(r(!0),o(H,null,G(w.value,(f,N)=>(r(),o("div",{key:f.id,class:"grid-item",style:Q({transitionDelay:`${Math.min(N,20)*30}ms`})},[O(mt,{template:f},null,8,["template"])],4))),128)),d.value?(r(!0),o(H,{key:0},G(x.value,f=>(r(),o("div",{key:"skeleton-more-"+f,class:"grid-item skeleton-placeholder",style:Q({height:$.value+"px",transitionDelay:`${Math.min(w.value.length+f,40)*12}ms`}),"aria-hidden":"true"},m[1]||(m[1]=[i("div",{class:"skeleton-card__thumb shimmer"},null,-1),i("div",{class:"skeleton-card__body"},[i("div",{class:"skeleton-line skeleton-line--title shimmer"}),i("div",{class:"skeleton-line skeleton-line--meta shimmer"})],-1)]),4))),128)):L("",!0)]),_:1}),i("div",{ref_key:"sentinel",ref:u,class:"infinite-sentinel",style:{height:"1px",width:"100%"}},null,512),v(a).loading&&!y.value?(r(),o("div",yt,"Загрузка…")):L("",!0)]))])],8,pt))}},kt=R(wt,[["__scopeId","data-v-e116ba3a"]]),$t={class:"portfolio-page"},Ft={__name:"templates",setup(c){const s=k("all");return ke({title:"Шаблоны",description:"Адаптивные шаблоны для лендингов, магазинов и портфолио — быстрый запуск сайта, простая настройка и SEO-готовность.",image:"https://sitebypro-server.ru/static/files/store/preview.png",url:"https://sitebypro.com/templates"}),(a,u)=>(r(),o("div",$t,[O(Re),O(Ue,{"active-filter":v(s),"onUpdate:activeFilter":u[0]||(u[0]=p=>be(s)?s.value=p:null)},null,8,["active-filter"]),O(kt,{"active-filter":v(s)},null,8,["active-filter"])]))}},Tt=R(Ft,[["__scopeId","data-v-81f957a1"]]);export{Tt as default};
