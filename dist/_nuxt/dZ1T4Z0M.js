import{_ as T,L as E,s as M,E as i,n as _,M as H,c as r,o as d,a,k as c,t as s,l as p,d as m,z as f,v as x}from"./D-6HeTC6.js";import{u as O}from"./CasnSq8p.js";const $={class:"container"},A={class:"wrapper"},F={class:"card main"},L={class:"title"},j={class:"meta"},q={class:"price"},G={class:"extras"},J={class:"addon"},K={key:0,class:"addon-ctrl"},Q={class:"addon"},W={key:1,class:"addon-ctrl"},X={class:"addon"},Y={class:"addon"},Z={key:0,class:"preview-link"},ee=["href"],te={class:"card sidebar"},ae={class:"order-lines"},le={class:"line"},ne={key:0,class:"line"},se={key:1,class:"line"},oe={key:2,class:"line"},ue={key:3,class:"line"},ie={key:4,class:"line"},re={class:"line"},de={key:5,class:"line discount"},ce={class:"line total"},ve={class:"order-actions"},pe={class:"input"},me={class:"input"},be=["disabled"],ge={__name:"[id]",setup(ye){const D=E(),z=O(),N=D.params.id;M(async()=>{if(N)try{await z.getTemplateById(N)}catch{}});const n=i(()=>z.current||{id:null,title:"",price:0,image:"",description:"",features:[],pages:[],technologies:[],screenshots:[],preview:"",discount_percent:0,discount_amount:0}),P=i(()=>Number(n.value.price||0)),t=_({extraPage:{enabled:!1,price:1e3,count:0},customization:{enabled:!1,pricePerHour:500,hours:0},priority:{enabled:!1,price:2e3},hosting:{enabled:!1,price:1e3}}),b=_([]);M(()=>{n.value.pages&&n.value.pages.length&&(b.value=[...n.value.pages])}),H(()=>{n.value.pages&&b.value.length===0&&(b.value=[...n.value.pages])});const v=_({name:"",contact:""}),y=_(!1),w=i(()=>b.value.length),V=i(()=>{const l=Number(t.value.extraPage.count||0),e=Number(t.value.extraPage.price||0);return t.value.extraPage.enabled&&l>0?l*e:0}),C=i(()=>{const l=Number(t.value.customization.hours||0),e=Number(t.value.customization.pricePerHour||0);return t.value.customization.enabled&&l>0?l*e:0}),B=i(()=>t.value.priority.enabled?Number(t.value.priority.price||0):0),I=i(()=>t.value.hosting.enabled?Number(t.value.hosting.price||0):0),g=i(()=>[P.value,V.value,C.value,B.value,I.value].reduce((e,o)=>e+Number(o||0),0)),h=i(()=>{const l=Number(n.value.discount_amount||0),e=Number(n.value.discount_percent||0);return l>0?Math.min(l,g.value):e>0?Math.min(Math.round(g.value*e/100),g.value):0}),R=i(()=>{const l=Number(n.value.discount_amount||0),e=Number(n.value.discount_percent||0);return l>0?`${u(l)}`:e>0?`${e}%`:""}),k=i(()=>{const l=g.value-h.value;return l>0?l:0});function u(l){try{const e=Number(l||0);return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",maximumFractionDigits:0}).format(Math.round(e))}catch{return`${l} ₽`}}function U(){t.value.extraPage.enabled=!1,t.value.extraPage.count=0,t.value.customization.enabled=!1,t.value.customization.hours=0,t.value.priority.enabled=!1,t.value.hosting.enabled=!1,b.value=n.value.pages?[...n.value.pages]:[],v.value={name:"",contact:""}}async function S(){if(!v.value.name||!v.value.contact){alert("Укажите имя и контакт для оформления заказа.");return}y.value=!0;try{const l={templateId:n.value.id,templateTitle:n.value.title,basePrice:P.value,extras:{extraPages:t.value.extraPage.enabled?{count:t.value.extraPage.count,unitPrice:t.value.extraPage.price}:null,customization:t.value.customization.enabled?{hours:t.value.customization.hours,rate:t.value.customization.pricePerHour}:null,priority:t.value.priority.enabled?{price:t.value.priority.price}:null,hosting:t.value.hosting.enabled?{price:t.value.hosting.price}:null},subtotal:g.value,discount:h.value,total:k.value,buyer:v.value,selectedPages:b.value,created_at:new Date().toISOString()};console.log("ORDER",l),alert(`Заявка отправлена!
Итог: `+u(k.value)),U()}catch(l){console.error(l),alert("Ошибка при оформлении заказа")}finally{y.value=!1}}return(l,e)=>(d(),r("div",$,[a("div",A,[a("section",F,[a("h1",L,'Сайт "'+s(n.value.title)+'"',1),a("div",j,[a("span",q,s(u(n.value.price)),1)]),a("div",G,[e[10]||(e[10]=a("h3",null,"Дополнительные опции",-1)),a("label",J,[p(a("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=o=>t.value.extraPage.enabled=o)},null,512),[[f,t.value.extraPage.enabled]]),m(" Доп. страница — "+s(u(t.value.extraPage.price))+" / страница ",1)]),t.value.extraPage.enabled?(d(),r("div",K,[a("label",null,[e[8]||(e[8]=m("Количество: ")),p(a("input",{type:"number",min:"0",step:"1","onUpdate:modelValue":e[1]||(e[1]=o=>t.value.extraPage.count=o)},null,512),[[x,t.value.extraPage.count,void 0,{number:!0}]])])])):c("",!0),a("label",Q,[p(a("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=o=>t.value.customization.enabled=o)},null,512),[[f,t.value.customization.enabled]]),m(" Кастомизация — "+s(u(t.value.customization.pricePerHour))+" / час ",1)]),t.value.customization.enabled?(d(),r("div",W,[a("label",null,[e[9]||(e[9]=m("Часы: ")),p(a("input",{type:"number",min:"0",step:"1","onUpdate:modelValue":e[3]||(e[3]=o=>t.value.customization.hours=o)},null,512),[[x,t.value.customization.hours,void 0,{number:!0}]])])])):c("",!0),a("label",X,[p(a("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=o=>t.value.priority.enabled=o)},null,512),[[f,t.value.priority.enabled]]),m(" Приоритетная доработка — "+s(u(t.value.priority.price)),1)]),a("label",Y,[p(a("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=o=>t.value.hosting.enabled=o)},null,512),[[f,t.value.hosting.enabled]]),m(" Подключение и хостинг — "+s(u(t.value.hosting.price)),1)])]),n.value.preview?(d(),r("div",Z,[a("a",{href:n.value.preview,target:"_blank",rel:"noopener"},"Открыть демо (preview)",8,ee)])):c("",!0)]),a("aside",te,[e[21]||(e[21]=a("h2",null,"Ваш заказ",-1)),a("div",ae,[a("div",le,[e[11]||(e[11]=a("span",null,"Базовая цена",-1)),a("span",null,s(u(P.value)),1)]),w.value!==n.value.pages.length?(d(),r("div",ne,[e[12]||(e[12]=a("span",null,"Выбранные страницы",-1)),a("span",null,s(w.value)+" / "+s(n.value.pages.length),1)])):c("",!0),t.value.extraPage.enabled&&t.value.extraPage.count>0?(d(),r("div",se,[a("span",null,"Доп. страницы (x"+s(t.value.extraPage.count)+")",1),a("span",null,s(u(V.value)),1)])):c("",!0),t.value.customization.enabled&&t.value.customization.hours>0?(d(),r("div",oe,[a("span",null,"Кастомизация ("+s(t.value.customization.hours)+" ч)",1),a("span",null,s(u(C.value)),1)])):c("",!0),t.value.priority.enabled?(d(),r("div",ue,[e[13]||(e[13]=a("span",null,"Приоритет",-1)),a("span",null,s(u(t.value.priority.price)),1)])):c("",!0),t.value.hosting.enabled?(d(),r("div",ie,[e[14]||(e[14]=a("span",null,"Подключение / хостинг",-1)),a("span",null,s(u(t.value.hosting.price)),1)])):c("",!0),e[17]||(e[17]=a("hr",null,null,-1)),a("div",re,[e[15]||(e[15]=a("strong",null,"Промежуточная сумма",-1)),a("strong",null,s(u(g.value)),1)]),h.value>0?(d(),r("div",de,[a("span",null,"Скидка "+s(R.value),1),a("span",null,"-"+s(u(h.value)),1)])):c("",!0),a("div",ce,[e[16]||(e[16]=a("strong",null,"Итого",-1)),a("strong",null,s(u(k.value)),1)])]),a("div",ve,[a("label",pe,[e[18]||(e[18]=m(" Имя: ")),p(a("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>v.value.name=o),placeholder:"Иван Иванов"},null,512),[[x,v.value.name]])]),a("label",me,[e[19]||(e[19]=m(" Телефон / email: ")),p(a("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>v.value.contact=o),placeholder:"+7 900 000-00-00 или email@example.com"},null,512),[[x,v.value.contact]])]),a("button",{class:"btn primary",disabled:y.value,onClick:S},s(y.value?"Оформление…":"Оформить заказ"),9,be),a("button",{class:"btn ghost",onClick:U},"Сбросить"),e[20]||(e[20]=a("div",{class:"note"},[a("small",null,"Нажимая «Оформить заказ», вы отправляете заявку. Реальная интеграция с оплатой/бекендом не включена в этот пример.")],-1))])])])]))}},fe=T(ge,[["__scopeId","data-v-af1d3939"]]);export{fe as default};
