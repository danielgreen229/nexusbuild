import{_ as j,r as P,E as oe,K as Z,c as o,o as s,a,v as N,t as m,C as ne,x as de,y as me,L as pe,G as h,d as q,F as O,z as Y,H as _e,D as ve,M as H,k as ae,b as R,w as le,N as ie,O as fe,P as te,B as he,T as ye,i as ge}from"./C8OgziG3.js";import{u as re}from"./CM6ehZi7.js";import be from"./Z5UIacbK.js";import{B as we}from"./BO_DcQUa.js";import"./LyCu--CD.js";const ke={class:"portfolio-hero"},$e={class:"portfolio-hero__container container"},Fe={class:"portfolio-hero__content"},Pe={class:"search-wrap"},xe=["onKeyup"],Te=["disabled"],Ee={key:0},Le={key:1},Se={key:0,class:"portfolio-hero__meta"},Me={class:"meta-count"},Ae={key:0,class:"meta-loading"},Ce={key:1,class:"meta-error"},Ne="Выберите подходящий шаблон",Ie="",He=300,Oe={__name:"PortfolioHero",setup(d){const l=re(),i=P(""),f=P(null);oe(async()=>{try{await l.listTemplates({page:1,perPage:12,filters:{}})}catch{}}),Z(i,r=>{f.value&&clearTimeout(f.value),f.value=setTimeout(async()=>{if(!r||String(r).trim()===""){await l.listTemplates({page:1,perPage:12,filters:{}});return}try{await l.listTemplates({page:1,perPage:12,filters:{search:r}})}catch{}},He)});async function _(){f.value&&(clearTimeout(f.value),f.value=null);try{await l.listTemplates({page:1,perPage:12,filters:{search:i.value}})}catch{}}return(r,y)=>(s(),o("section",ke,[a("div",$e,[a("div",Fe,[a("h1",{class:"portfolio-hero__title"},m(Ne)),a("p",{class:"portfolio-hero__subtitle"},m(Ie)),a("form",{class:"portfolio-hero__search",onSubmit:ne(_,["prevent"]),"aria-label":"Поиск шаблонов"},[a("div",Pe,[de(a("input",{"onUpdate:modelValue":y[0]||(y[0]=g=>i.value=g),onKeyup:pe(ne(_,["prevent"]),["enter"]),type:"search",placeholder:"Найти шаблон...",class:"portfolio-hero__input","aria-label":"Поиск шаблонов"},null,40,xe),[[me,i.value]]),a("button",{type:"submit",class:"btn-search",disabled:h(l).loading},[h(l).loading?(s(),o("span",Ee,"Поиск...")):(s(),o("span",Le,"Найти"))],8,Te)])],32),h(l).templates&&h(l).templates.length>=0?(s(),o("div",Se,[a("span",Me,[y[1]||(y[1]=q(" Найдено: ")),a("strong",null,m(h(l).total??h(l).templates.length),1)]),h(l).loading?(s(),o("span",Ae," · загружается…")):N("",!0),h(l).error?(s(),o("span",Ce," · Ошибка: "+m(h(l).error),1)):N("",!0)])):N("",!0)])])]))}},Re=j(Oe,[["__scopeId","data-v-9aae542a"]]),Be={class:"portfolio-filters"},De={class:"portfolio-filters__container container"},qe={class:"portfolio-filters__wrapper"},ze=["onClick"],je={__name:"PortfolioFilters",props:{activeFilter:{type:String,required:!0}},emits:["update:activeFilter"],setup(d,{emit:l}){const i=l,f=P([{id:"all",name:"Все шаблоны"}]),_=r=>{i("update:activeFilter",r)};return(r,y)=>(s(),o("section",Be,[a("div",De,[a("div",qe,[(s(!0),o(O,null,Y(h(f),g=>(s(),o("button",{key:g.id,class:_e(["portfolio-filters__button",{"portfolio-filters__button--active":d.activeFilter===g.id}]),onClick:S=>_(g.id)},m(g.name),11,ze))),128))])])]))}},Ve=j(je,[["__scopeId","data-v-c6fd089d"]]),Ge={class:"template-card",role:"group",tabindex:"0"},Ue=["src","alt"],Ye={class:"template-card__badges"},Ke={key:0,class:"template-card__badge template-card__badge--custom"},We={key:1,class:"template-card__badge template-card__badge--popular"},Xe={class:"template-card__content"},Ze={class:"template-card__header"},Je={class:"template-card__title"},Qe={class:"template-card__price","aria-live":"polite"},et={key:0,style:{"text-align":"right"}},tt={style:{"font-size":"0.9rem",color:"#64748b","text-decoration":"line-through"}},nt={style:{"font-size":"1.2rem","font-weight":"700",color:"#f97315"}},at={style:{"font-size":"0.8rem",color:"#065f46"}},it={key:0},ot={class:"template-card__description"},st={class:"template-card__features"},lt=40,G="0%",rt={__name:"TemplateCard",props:{template:{type:Object,required:!0}},emits:["view"],setup(d,{emit:l}){const i=d,f=l;ve();const _=P(!1),r=e=>{const t=Number(e)||0;return Math.round((t+Number.EPSILON)*100)/100},y=e=>{const t=Number(e)||0;return t.toLocaleString("ru-RU",{minimumFractionDigits:t%1===0?0:2,maximumFractionDigits:2})},g=H(()=>{var t,c;const e=((t=i.template)==null?void 0:t.have_html)??((c=i.template)==null?void 0:c.haveHtml);return typeof e<"u"?!!e:typeof window<"u"?!!(window!=null&&window.have_html):!1}),S=H(()=>r(i.template.price??i.template.price_cents??0)),B=H(()=>{const e=i.template.discount_percent??i.template.discountPercent??i.template.discount??0;return Number.isFinite(Number(e))?r(Number(e)):0}),z=H(()=>r(i.template.discount_amount??i.template.discountAmount??i.template.discount_amount_cents??0)),V=H(()=>z.value>0?r(z.value):B.value>0?r(S.value*B.value/100):0),K=H(()=>{const e=S.value-V.value;return r(e>0?e:0)}),J=async e=>{await fe({path:"/buy-template/"+e})},Q=(e,t)=>{f("view",i.template),e&&window.open(e,"_blank","noopener,noreferrer")},E=P(null),$=P(null);let F=null,b=0,p=0,M=1,w=0,I=!1,x=!1;const A={x:null,y:null},L=()=>{const e=E.value,t=$.value;if(!e||!t){w=0;return}const c=e.naturalWidth||e.width,T=e.naturalHeight||e.height,se=t.clientWidth,ee=t.clientHeight;if(!c||!T||!se||!ee){w=0;return}const ce=Math.max(se/c,ee/T),ue=T*ce;w=Math.max(0,Math.round(ue-ee)),w<=0&&(p=0,e.style.objectPosition=`${G} 0%`,e.style.transform="")},W=e=>{const t=E.value;if(t)if(w>0){const c=Math.min(100,Math.max(0,e/w*100));t.style.objectPosition=`${G} ${c}%`}else t.style.objectPosition=`${G} 0%`,t.style.transform=""},n=e=>{if(!I)return;if(x){F=requestAnimationFrame(n);return}b||(b=e);const t=e-b;b=e;const c=lt*t/1e3*M;let T=p+c;T>=w?(T=w,M=-1):T<=0&&(T=0,M=1),p=T,W(p),F=requestAnimationFrame(n)},u=()=>{try{if(!$.value||A.x==null)return!1;const t=document.elementFromPoint(A.x,A.y);if(!t)return!1;const c=t.closest&&t.closest('button, a, input, textarea, [role="button"], label');return!(!c||c.classList&&c.classList.contains("template-card__view-button"))}catch{return!1}},k=e=>{A.x=e.clientX,A.y=e.clientY;const t=u();t&&I&&!x?x=!0:!t&&x&&(x=!1,b=0)},C=async e=>{e&&e.clientX!=null&&(A.x=e.clientX,A.y=e.clientY),await ie(),L();const t=E.value;if(w<=0){if(t&&!t.complete){const c=()=>{t.removeEventListener("load",c),L(),w>0&&$.value&&$.value.matches(":hover")&&requestAnimationFrame(()=>C())};t.addEventListener("load",c,{once:!0})}return}t&&(t._tmpl_return_end&&(t.removeEventListener("transitionend",t._tmpl_return_end),t._tmpl_return_end=null),t.style.transition="none"),p=0,M=1,W(0),x=u(),F&&cancelAnimationFrame(F),I=!0,b=0,F=requestAnimationFrame(n)},v=()=>{I=!1,x=!1,F&&(cancelAnimationFrame(F),F=null);const e=E.value;if(!e)return;if(p===0){e.style.transition="",e.style.willChange="",p=0,M=1,b=0;return}e.style.transition="object-position 600ms cubic-bezier(.22,.9,.35,1), transform 600ms cubic-bezier(.22,.9,.35,1)",e.style.objectPosition=`${G} 0%`,e.style.transform="",e._tmpl_return_end&&e.removeEventListener("transitionend",e._tmpl_return_end);const t=c=>{(!c.propertyName||c.propertyName.includes("object")||c.propertyName.includes("transform"))&&(e.style.transition="",e.style.willChange="",p=0,M=1,b=0,e.removeEventListener("transitionend",t),e._tmpl_return_end=null)};e._tmpl_return_end=t,e.addEventListener("transitionend",t)},D=e=>C(e),X=()=>v();return oe(()=>{const e=E.value,t=$.value;e&&(e.style.objectPosition=`${G} 0%`,e.style.willChange="object-position",e.complete?L():e.addEventListener("load",L)),t&&(t.addEventListener("pointerenter",D),t.addEventListener("pointerleave",X),t.addEventListener("pointermove",k)),window.addEventListener("resize",L)}),ae(()=>{F&&cancelAnimationFrame(F);const e=E.value,t=$.value;e&&e.removeEventListener("load",L),t&&(t.removeEventListener("pointerenter",D),t.removeEventListener("pointerleave",X),t.removeEventListener("pointermove",k)),window.removeEventListener("resize",L)}),(e,t)=>(s(),o("div",Ge,[a("div",{class:"template-card__image",ref_key:"imageWrapperRef",ref:$},[a("img",{ref_key:"imageRef",ref:E,src:d.template.preview,alt:d.template.title,loading:"lazy",draggable:"false"},null,8,Ue),a("div",Ye,[g.value?N("",!0):(s(),o("div",Ke,"Заказной")),d.template.popular?(s(),o("div",We,"Популярный")):N("",!0)]),a("button",{class:"template-card__view-button",type:"button","aria-label":"Просмотреть шаблон",onClick:t[0]||(t[0]=ne(c=>Q(d.template.preview),["stop"]))},[t[2]||(t[2]=q(" Просмотреть ")),R(h(be),{class:"open-next__svg"})])],512),a("div",Xe,[a("div",Ze,[a("h3",Je,m(d.template.title),1),a("div",Qe,[V.value>0?(s(),o("div",et,[a("div",tt,m(y(S.value))+" ₽",1),a("div",nt,m(y(K.value))+" ₽",1),a("div",at,[t[3]||(t[3]=q("Скидка: ")),B.value>0?(s(),o("span",it,m(B.value)+"%",1)):N("",!0)])])):(s(),o(O,{key:1},[q(m(y(S.value))+" ₽",1)],64))])]),a("p",ot,m(d.template.description),1),a("div",st,[(s(!0),o(O,null,Y(d.template.features,(c,T)=>(s(),o("span",{key:T,class:"template-card__feature"},m(c),1))),128))]),R(we,{class:"template-card__button button button--primary",disabled:_.value,onClick:t[1]||(t[1]=c=>J(d.template.id))},{default:le(()=>[q(m(_.value?"Покупка...":"Купить шаблон"),1)]),_:1},8,["disabled"])])]))}},ct=j(rt,[["__scopeId","data-v-08041a49"]]),ut=["aria-busy"],dt={class:"portfolio-grid__container container"},mt={class:"portfolio-grid__header"},pt={class:"portfolio-grid__title"},_t={key:2},vt={key:3},ft={class:"portfolio-grid__loading-hint"},ht={key:0,class:"portfolio-grid__content"},yt={key:1,class:"portfolio-grid__empty"},gt={key:2,class:"portfolio-grid__content"},bt={key:0,class:"portfolio-grid__loading"},U=12,wt="have_html,popular,created_at",kt="desc",$t={__name:"PortfolioGrid",props:{activeFilter:{type:String,required:!0}},setup(d){const l=d,i=re(),f=P([{id:"all",name:"Все шаблоны"}]),_=P(null);let r=null;const y=P(!1),g=H(()=>i.loading&&i.templates.length===0),S=P(240);function B(){const n={};return l.activeFilter&&l.activeFilter!=="all"&&(n.type=l.activeFilter),n}async function z(){await ie();try{const n=document.querySelector(".portfolio-grid__content .grid-item");n&&n.offsetHeight&&(S.value=n.offsetHeight)}catch{}}async function V({page:n=1,perPage:u=U,filters:k={},append:C=!1}={}){const v={...k};return i.listTemplates({page:n,perPage:u,filters:v,append:C,sortBy:wt,order:kt})}async function K(){try{i.perPage=U;const n=B();await V({page:1,perPage:U,filters:n,append:!1}),await z()}catch(n){console.error("Ошибка загрузки шаблонов:",n)}}async function J(){if(!(i.loading||y.value)&&i.hasMore){y.value=!0,await z();try{const n=B(),u=(Number(i.page)||1)+1;await V({page:u,perPage:U,filters:n,append:!0}),await z()}catch(n){console.warn("Ошибка подгрузки следующей страницы:",n)}finally{y.value=!1}}}const Q=n=>{for(const u of n)u.isIntersecting&&J()};function E(){if(r){try{_.value&&r.unobserve(_.value),r.disconnect()}catch{}r=null}r=new IntersectionObserver(Q,{root:null,rootMargin:"300px",threshold:.1}),ie(()=>{_.value&&r.observe(_.value)})}oe(async()=>{await K(),E()}),ae(()=>{if(r){try{_.value&&r.unobserve(_.value),r.disconnect()}catch{}r=null}}),Z(()=>l.activeFilter,async()=>{await K(),E()});const $=H(()=>{const n=i.templates||[];return l.activeFilter==="all"?n:n.filter(u=>String(u.type)===String(l.activeFilter))}),F=P(U),b=P(0);let p=null,M=0,w=0,I=0,x=600;const A=n=>1-Math.pow(1-n,3);function L(n,u=x){p!==null&&(cancelAnimationFrame(p),p=null),M=performance.now(),w=b.value,I=n,x=u;const k=C=>{const v=C-M,D=Math.min(1,v/x),X=A(D);b.value=Math.round(w+(I-w)*X),D<1?p=requestAnimationFrame(k):(p=null,b.value=I)};p=requestAnimationFrame(k)}ae(()=>{p!==null&&(cancelAnimationFrame(p),p=null)});function W(n){const u=n%10,k=n%100;return u===1&&k!==11?"шаблон":u>=2&&u<=4&&!(k>=12&&k<=14)?"шаблона":"шаблонов"}return b.value=i.loading?0:$.value.length,Z(()=>$.value.length,n=>{i.loading||L(n)}),Z(()=>i.loading,(n,u)=>{u===!0&&n===!1&&L($.value.length)}),(n,u)=>{var k,C;return s(),o("section",{class:"portfolio-grid","aria-busy":g.value?"true":"false"},[a("div",dt,[a("div",mt,[a("h2",pt,[g.value?(s(),o(O,{key:0},[q("… шаблонов")],64)):(s(),o(O,{key:1},[q(m(b.value)+" "+m(W(b.value)),1)],64)),!g.value&&d.activeFilter!=="all"?(s(),o("span",_t,' в категории "'+m(((k=f.value.find(v=>v.id===d.activeFilter))==null?void 0:k.name)||d.activeFilter)+'" ',1)):g.value&&d.activeFilter!=="all"?(s(),o("span",vt,[a("small",ft,"в категории «"+m(((C=f.value.find(v=>v.id===d.activeFilter))==null?void 0:C.name)||d.activeFilter)+"»",1)])):N("",!0)])]),g.value?(s(),o("div",ht,[(s(!0),o(O,null,Y(F.value,v=>(s(),o("div",{key:"skeleton-init-"+v,class:"skeleton-card",role:"status","aria-label":"Загрузка шаблона",style:te({minHeight:S.value+"px"})},u[0]||(u[0]=[he('<div class="skeleton-card__thumb shimmer" data-v-7b7b5b0e></div><div class="skeleton-card__body" data-v-7b7b5b0e><div class="skeleton-line skeleton-line--title shimmer" data-v-7b7b5b0e></div><div class="skeleton-line skeleton-line--meta shimmer" data-v-7b7b5b0e></div><div class="skeleton-line skeleton-line--meta short shimmer" data-v-7b7b5b0e></div></div>',2)]),4))),128))])):h(i).error?(s(),o("div",yt," Ошибка: "+m(h(i).error),1)):(s(),o("div",gt,[R(ye,{name:"grid",tag:"div",class:"portfolio-grid__content-inner"},{default:le(()=>[(s(!0),o(O,null,Y($.value,(v,D)=>(s(),o("div",{key:v.id,class:"grid-item",style:te({transitionDelay:`${Math.min(D,20)*30}ms`})},[R(ct,{template:v},null,8,["template"])],4))),128)),y.value?(s(!0),o(O,{key:0},Y(F.value,v=>(s(),o("div",{key:"skeleton-more-"+v,class:"grid-item skeleton-placeholder",style:te({height:S.value+"px",transitionDelay:`${Math.min($.value.length+v,40)*12}ms`}),"aria-hidden":"true"},u[1]||(u[1]=[a("div",{class:"skeleton-card__thumb shimmer"},null,-1),a("div",{class:"skeleton-card__body"},[a("div",{class:"skeleton-line skeleton-line--title shimmer"}),a("div",{class:"skeleton-line skeleton-line--meta shimmer"})],-1)]),4))),128)):N("",!0)]),_:1}),a("div",{ref_key:"sentinel",ref:_,class:"infinite-sentinel",style:{height:"1px",width:"100%"}},null,512),h(i).loading&&!g.value?(s(),o("div",bt,"Загрузка…")):N("",!0)]))])],8,ut)}}},Ft=j($t,[["__scopeId","data-v-7b7b5b0e"]]),Pt={class:"portfolio-cta"},xt="Нужен уникальный дизайн?",Tt="Разработаем эксклюзивный сайт специально для вас",Et={__name:"PortfolioCTA",setup(d){return(l,i)=>(s(),o("section",Pt,[a("div",{class:"portfolio-cta__container container"},[a("div",{class:"portfolio-cta__content"},[a("h2",{class:"portfolio-cta__title"},m(xt)),a("p",{class:"portfolio-cta__subtitle"},m(Tt)),i[0]||(i[0]=a("button",{class:"portfolio-cta__button button button--primary"}," Заказать дизайн ",-1))])])]))}},Lt=j(Et,[["__scopeId","data-v-f329e64b"]]),St={class:"portfolio-page"},Mt={__name:"templates",setup(d){const l=P("all");return(i,f)=>(s(),o("div",St,[R(Re),R(Ve,{"active-filter":h(l),"onUpdate:activeFilter":f[0]||(f[0]=_=>ge(l)?l.value=_:null)},null,8,["active-filter"]),R(Ft,{"active-filter":h(l)},null,8,["active-filter"]),R(Lt)]))}},Ot=j(Mt,[["__scopeId","data-v-5442f79c"]]);export{Ot as default};
