import{j as c,A as p}from"./D-6HeTC6.js";function d(t={}){const s=Object.entries(t).filter(([,r])=>r!=null&&r!=="").map(([r,o])=>`${encodeURIComponent(r)}=${encodeURIComponent(o)}`).join("&");return s?`?${s}`:""}const y=c("template",{state:()=>({loading:!1,error:null,templates:[],current:null,total:0,page:1,perPage:20,nextCursor:null,hasMore:!0,testResult:null}),getters:{isLoading:t=>t.loading,hasError:t=>!!t.error,templatesCount:t=>t.templates.length,canLoadMore:t=>t.hasMore,currentTemplate:t=>t.current},actions:{async _request({method:t="GET",path:s="",params:r=null,body:o=null}={}){this.loading=!0,this.error=null;try{const e=r?d(r):"",u=`${p.fullUrl}/template${s}${e}`,i={method:t,headers:{}};o&&(t==="POST"||t==="PUT"||t==="PATCH")&&(i.headers["Content-Type"]="application/json",i.body=JSON.stringify(o));const l=await fetch(u,i);let a=null;try{a=await l.json()}catch{if(!l.ok)throw new Error(l.statusText||"Network error");return null}if(!l.ok){const n=a&&(a.description||a.data)?a.description||a.data:l.statusText||`HTTP ${l.status}`;throw new Error(n)}if(a&&typeof a=="object"&&"status"in a){if(String(a.status)==="200")return a.data;const n=a.description||a.data||"Server error";throw new Error(n)}return a}catch(e){throw this.error=e.message||String(e),e}finally{this.loading=!1}},async test(){const t=await this._request({method:"GET",path:"/test"});return this.testResult=t,t},async createTemplate(t){const s=await this._request({method:"POST",path:"/",body:t});return s&&s.id&&(this.templates.unshift(s),this.total=Number(this.total||0)+1),s},async getTemplateById(t){if(!t)throw new Error("id is required");const s=await this._request({method:"GET",path:`/${encodeURIComponent(t)}`});return this.current=s,s},async getTemplateByUid(t){if(!t)throw new Error("uid is required");const s=await this._request({method:"GET",path:`/uid/${encodeURIComponent(t)}`});return this.current=s,s},async updateTemplate(t,s){if(!t)throw new Error("id is required");const r=await this._request({method:"PUT",path:`/${encodeURIComponent(t)}`,body:s});if(r){const o=this.templates.findIndex(e=>e.id===r.id);o!==-1&&this.templates.splice(o,1,r),this.current&&this.current.id===r.id&&(this.current=r)}return r},async deleteTemplate(t){if(!t)throw new Error("id is required");const s=await this._request({method:"DELETE",path:`/${encodeURIComponent(t)}`}),r=this.templates.findIndex(o=>o.id===Number(t));return r!==-1&&(this.templates.splice(r,1),this.total=Math.max(0,Number(this.total||0)-1)),this.current&&this.current.id===Number(t)&&(this.current=null),s},async listTemplates({page:t=1,perPage:s=20,filters:r={}}={}){const o={page:t,perPage:s,type:r.type,popular:typeof r.popular<"u"?r.popular?"1":"0":void 0,min_price:r.min_price,max_price:r.max_price,search:r.search,uid:r.uid},e=await this._request({method:"GET",path:"/",params:o});let u=[],i=0,l=t,a=s;if(Array.isArray(e))u=e,i=e.length;else if(e&&typeof e=="object")if(Array.isArray(e.rows))u=e.rows,i=Number(e.total??u.length),l=Number(e.page??t),a=Number(e.perPage??s);else if(e.data&&typeof e.data=="object"){const n=e.data;Array.isArray(n.rows)?(u=n.rows,i=Number(n.total??u.length),l=Number(n.page??t),a=Number(n.perPage??s)):Array.isArray(n)&&(u=n,i=n.length)}else{const n=Object.values(e).find(h=>Array.isArray(h));n&&(u=n,i=Number(e.total??u.length))}return this.templates=u,this.total=Number(i||0),this.page=l,this.perPage=a,this.nextCursor=null,this.hasMore=this.templates.length<this.total,e},async listTemplatesInfinite({limit:t=20,lastCreatedAt:s=null,lastId:r=null,order:o="desc",filters:e={}}={}){const u={limit:t,lastCreatedAt:s,lastId:r,order:o,type:e.type,popular:typeof e.popular<"u"?e.popular?"1":"0":void 0,min_price:e.min_price,max_price:e.max_price,search:e.search,uid:e.uid},i=await this._request({method:"GET",path:"/infinite",params:u}),l=i&&Array.isArray(i.rows)?i.rows:[],a=i&&i.nextCursor?i.nextCursor:null;return!s&&!r?this.templates=l:this.templates=this.templates.concat(l),this.nextCursor=a,this.hasMore=!!a&&l.length>0,i},async searchByTitle(t,s=20){if(!t)throw new Error("query q is required");const r={q:t,limit:s};return await this._request({method:"GET",path:"/search/title",params:r})},clearError(){this.error=null},reset(){this.loading=!1,this.error=null,this.templates=[],this.current=null,this.total=0,this.page=1,this.perPage=20,this.nextCursor=null,this.hasMore=!0,this.testResult=null}}});export{y as u};
