import{f as m,A as g,_ as y,c,o as h,a as s,g as x,h as d,v as a,F as w,r as b,t as p}from"./xo8e5jVH.js";const f=m("landing",{state:()=>({loading:!1,error:null,landings:[],landing:null}),getters:{isLoading(e){return e.loading},hasError(e){return!!e.error}},actions:{async parseResponse(e){const t=await e.json().catch(()=>null);if(!e.ok){const n=t&&(t.data||t.description||t.message)||e.statusText||"Network error";throw new Error(n)}return t&&(t.status==="200"||t.status===200)||t&&t.data!==void 0?t.data:t},async addLandingSettings(e){this.loading=!0,this.error=null;try{const t=await fetch(`${g.fullUrl}/landing/add-settings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=await this.parseResponse(t);if(n){const l=this.landings.findIndex(r=>r.id&&n.id&&r.id===n.id||r.uid&&n.uid&&r.uid===n.uid);l!==-1?this.landings.splice(l,1,n):this.landings.unshift(n),this.landing=n}return n}catch(t){throw this.error=t.message||"Ошибка",t}finally{this.loading=!1}},async fetchLanding(e){if(!e)throw new Error("id обязателен");this.loading=!0,this.error=null;try{const t=await fetch(`${g.fullUrl}/landing/landing/${e}`),n=await this.parseResponse(t);return this.landing=n,n}catch(t){throw this.error=t.message,t}finally{this.loading=!1}},async fetchLandingByUid(e){if(!e)throw new Error("uid обязателен");this.loading=!0,this.error=null;try{const t=await fetch(`${g.fullUrl}/landing/landing-uid/${e}`),n=await this.parseResponse(t);return this.landing=n,n}catch(t){throw this.error=t.message,t}finally{this.loading=!1}},async fetchAll(){this.loading=!0,this.error=null;try{const e=await fetch(`${g.fullUrl}/landing/landings`),t=await this.parseResponse(e);return this.landings=Array.isArray(t)?t:t?[t]:[],this.landings}catch(e){throw this.error=e.message,e}finally{this.loading=!1}},async updateLanding(e,t){if(!e)throw new Error("id обязателен");this.loading=!0,this.error=null;try{const n=await fetch(`${g.fullUrl}/landing/landing/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),l=await this.parseResponse(n);if(l){const r=this.landings.findIndex(o=>o.id&&l.id&&o.id===l.id);r!==-1&&this.landings.splice(r,1,l),this.landing=l}return l}catch(n){throw this.error=n.message,n}finally{this.loading=!1}},async deleteLanding(e){if(!e)throw new Error("id обязателен");this.loading=!0,this.error=null;try{const t=await fetch(`${g.fullUrl}/landing/landing/${e}`,{method:"DELETE"}),n=await this.parseResponse(t),l=this.landings.findIndex(r=>r.id&&r.id===Number(e)||r.id&&r.id===e);return l!==-1&&this.landings.splice(l,1),this.landing&&(this.landing.id===e||this.landing.id===Number(e))&&(this.landing=null),n}catch(t){throw this.error=t.message,t}finally{this.loading=!1}}}}),_={name:"LandingTable",data(){return{landings:[],newLanding:{uid:"",bg_color:"#f5511e",font:null,logo:"",user_uid:"",title:"",preview:null,url:null,url_preview:null},dateFrom:"",dateTo:"",error:null}},computed:{filteredLandings(){return this.landings.filter(e=>{if(!e.dt_created)return!0;const t=new Date(e.dt_created),n=this.dateFrom?new Date(this.dateFrom):null,l=this.dateTo?new Date(this.dateTo):null;return!(n&&t<n||l&&t>l)})}},methods:{async fetchAll(){try{const e=f();this.landings=await e.fetchAll()}catch(e){this.error=e.message}},async addLanding(){try{const t=await f().addLandingSettings(this.newLanding);this.landings.find(l=>l.id===t.id)||this.landings.unshift(t),this.newLanding={uid:"",bg_color:"#f5511e",font:null,logo:"",user_uid:"",title:"",preview:null,url:null,url_preview:null},this.error=null}catch(e){this.error=e.message}},async updateLanding(e){try{await f().updateLanding(e.id,e),this.error=null}catch(t){this.error=t.message}},async deleteLanding(e){try{await f().deleteLanding(e),this.landings=this.landings.filter(n=>n.id!==e)}catch(t){this.error=t.message}}},mounted(){this.fetchAll()}},L={class:"p-6 max-w-6xl mx-auto"},v={class:"flex gap-4 mb-4"},U={class:"overflow-x-auto border rounded-lg mb-6"},V={class:"min-w-full divide-y divide-gray-200"},T={class:"bg-white divide-y divide-gray-200"},k={class:"px-4 py-2 text-sm text-gray-700"},D={class:"px-4 py-2 text-sm text-gray-700"},E={class:"px-4 py-2"},S=["onUpdate:modelValue"],A={class:"px-4 py-2"},C=["onUpdate:modelValue"],I={class:"px-4 py-2"},R=["onUpdate:modelValue"],F={class:"px-4 py-2 text-sm text-gray-700"},N={class:"px-4 py-2 space-x-2"},j=["onClick"],B=["onClick"],O={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},P={key:0,class:"mt-4 text-red-600"};function J(e,t,n,l,r,o){return h(),c("div",L,[t[10]||(t[10]=s("h2",{class:"text-2xl font-bold mb-6"},"Управление страницами",-1)),s("div",v,[s("div",null,[t[7]||(t[7]=s("label",null,"С:",-1)),d(s("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=i=>r.dateFrom=i),class:"border rounded p-2"},null,512),[[a,r.dateFrom]])]),s("div",null,[t[8]||(t[8]=s("label",null,"По:",-1)),d(s("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=i=>r.dateTo=i),class:"border rounded p-2"},null,512),[[a,r.dateTo]])])]),s("div",U,[s("table",V,[t[9]||(t[9]=s("thead",{class:"bg-gray-100"},[s("tr",null,[s("th",{class:"px-4 py-2 text-left text-sm font-medium text-gray-700"},"ID"),s("th",{class:"px-4 py-2 text-left text-sm font-medium text-gray-700"},"UID"),s("th",{class:"px-4 py-2 text-left text-sm font-medium text-gray-700"},"Название"),s("th",{class:"px-4 py-2 text-left text-sm font-medium text-gray-700"},"Цвет фона"),s("th",{class:"px-4 py-2 text-left text-sm font-medium text-gray-700"},"Логотип"),s("th",{class:"px-4 py-2 text-left text-sm font-medium text-gray-700"},"Дата создания"),s("th",{class:"px-4 py-2 text-left text-sm font-medium text-gray-700"},"Действия")])],-1)),s("tbody",T,[(h(!0),c(w,null,b(o.filteredLandings,i=>(h(),c("tr",{key:i.id,class:"hover:bg-gray-50"},[s("td",k,p(i.id),1),s("td",D,p(i.uid),1),s("td",E,[d(s("input",{"onUpdate:modelValue":u=>i.title=u,class:"border rounded px-2 py-1 w-full"},null,8,S),[[a,i.title]])]),s("td",A,[d(s("input",{"onUpdate:modelValue":u=>i.bg_color=u,type:"color",class:"w-full h-8 border rounded p-1"},null,8,C),[[a,i.bg_color]])]),s("td",I,[d(s("input",{"onUpdate:modelValue":u=>i.logo=u,class:"border rounded px-2 py-1 w-full"},null,8,R),[[a,i.logo]])]),s("td",F,p(i.dt_created?new Date(i.dt_created).toLocaleString():""),1),s("td",N,[s("button",{onClick:u=>o.updateLanding(i),class:"bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600"},"Сохранить",8,j),s("button",{onClick:u=>o.deleteLanding(i.id),class:"bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600"},"Удалить",8,B)])]))),128))])])]),t[11]||(t[11]=s("h3",{class:"text-xl font-semibold mb-2"},"Создать новую страницу",-1)),s("div",O,[d(s("input",{"onUpdate:modelValue":t[2]||(t[2]=i=>r.newLanding.title=i),placeholder:"Название",class:"border rounded p-2"},null,512),[[a,r.newLanding.title]]),d(s("input",{"onUpdate:modelValue":t[3]||(t[3]=i=>r.newLanding.bg_color=i),type:"color",class:"border rounded p-2"},null,512),[[a,r.newLanding.bg_color]]),d(s("input",{"onUpdate:modelValue":t[4]||(t[4]=i=>r.newLanding.logo=i),placeholder:"URL логотипа",class:"border rounded p-2"},null,512),[[a,r.newLanding.logo]]),d(s("input",{"onUpdate:modelValue":t[5]||(t[5]=i=>r.newLanding.user_uid=i),placeholder:"User UID",class:"border rounded p-2"},null,512),[[a,r.newLanding.user_uid]])]),s("button",{onClick:t[6]||(t[6]=(...i)=>o.addLanding&&o.addLanding(...i)),class:"bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"},"Создать"),r.error?(h(),c("div",P,p(r.error),1)):x("",!0)])}const q=y(_,[["render",J],["__scopeId","data-v-6768c2ae"]]);export{q as default};
