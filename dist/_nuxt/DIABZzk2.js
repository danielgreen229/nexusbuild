import{_ as R,i as k,j as ae,z as K,c as o,o as r,a as s,g as I,t as b,B as ee,h as me,v as pe,K as _e,C as f,d as G,F as O,r as U,E as re,x as ve,p as fe,y as C,k as te,b as z,w as le,n as ne,G as he,M as Q,D as ye,N as ge,O as be}from"./xo8e5jVH.js";import{u as ce}from"./WZmaIR9D.js";import we from"./dv6bPjHY.js";const ke={class:"portfolio-hero"},$e={class:"portfolio-hero__container container"},Fe={class:"portfolio-hero__content"},Pe={class:"search-wrap"},xe=["onKeyup"],Ee=["disabled"],Te={key:0},Le={key:1},Se={key:0,class:"portfolio-hero__meta"},Me={class:"meta-count"},Ae={key:0,class:"meta-loading"},Ne={key:1,class:"meta-error"},Ce="Выберите подходящий шаблон",Ie="",ze=300,He={__name:"PortfolioHero",setup(c){const i=ce(),a=k(""),u=k(null);ae(async()=>{try{await i.listTemplates({page:1,perPage:12,filters:{}})}catch{}}),K(a,d=>{u.value&&clearTimeout(u.value),u.value=setTimeout(async()=>{if(!d||String(d).trim()===""){await i.listTemplates({page:1,perPage:12,filters:{}});return}try{await i.listTemplates({page:1,perPage:12,filters:{search:d}})}catch{}},ze)});async function p(){u.value&&(clearTimeout(u.value),u.value=null);try{await i.listTemplates({page:1,perPage:12,filters:{search:a.value}})}catch{}}return(d,y)=>(r(),o("section",ke,[s("div",$e,[s("div",Fe,[s("h1",{class:"portfolio-hero__title"},b(Ce)),s("p",{class:"portfolio-hero__subtitle"},b(Ie)),s("form",{class:"portfolio-hero__search",onSubmit:ee(p,["prevent"]),"aria-label":"Поиск шаблонов"},[s("div",Pe,[me(s("input",{"onUpdate:modelValue":y[0]||(y[0]=$=>a.value=$),onKeyup:_e(ee(p,["prevent"]),["enter"]),type:"search",placeholder:"Найти шаблон...",class:"portfolio-hero__input","aria-label":"Поиск шаблонов"},null,40,xe),[[pe,a.value]]),s("button",{type:"submit",class:"btn-search",disabled:f(i).loading},[f(i).loading?(r(),o("span",Te,"Поиск...")):(r(),o("span",Le,"Найти"))],8,Ee)])],32),f(i).templates&&f(i).templates.length>=0?(r(),o("div",Se,[s("span",Me,[y[1]||(y[1]=G(" Найдено: ")),s("strong",null,b(f(i).total??f(i).templates.length),1)]),f(i).loading?(r(),o("span",Ae," · загружается…")):I("",!0),f(i).error?(r(),o("span",Ne," · Ошибка: "+b(f(i).error),1)):I("",!0)])):I("",!0)])])]))}},Oe=R(He,[["__scopeId","data-v-9aae542a"]]),Re={class:"portfolio-filters"},Be={class:"portfolio-filters__container container"},De={class:"portfolio-filters__wrapper"},qe=["onClick"],je={__name:"PortfolioFilters",props:{activeFilter:{type:String,required:!0}},emits:["update:activeFilter"],setup(c,{emit:i}){const a=i,u=k([{id:"all",name:"Все шаблоны"}]),p=d=>{a("update:activeFilter",d)};return(d,y)=>(r(),o("section",Re,[s("div",Be,[s("div",De,[(r(!0),o(O,null,U(f(u),$=>(r(),o("button",{key:$.id,class:re(["portfolio-filters__button",{"portfolio-filters__button--active":c.activeFilter===$.id}]),onClick:S=>p($.id)},b($.name),11,qe))),128))])])]))}},Ve=R(je,[["__scopeId","data-v-f61ec0aa"]]),Ge={__name:"Button",props:{variant:{type:String,default:"primary",validator:c=>["primary","outline"].includes(c)},size:{type:String,default:"md",validator:c=>["sm","md","lg"].includes(c)}},setup(c){return(i,a)=>(r(),o("button",{class:re(["button",`button--${c.variant}`,`button--${c.size}`])},[ve(i.$slots,"default",{},void 0,!0)],2))}},Ue=R(Ge,[["__scopeId","data-v-62a209ae"]]),Ye={class:"template-card",role:"group",tabindex:"0"},Ke=["src","alt"],We={class:"template-card__badges"},Xe={key:0,class:"template-card__badge template-card__badge--custom"},Ze={key:1,class:"template-card__badge template-card__badge--popular"},Je={class:"template-card__content"},Qe={class:"template-card__header"},et={class:"template-card__title"},tt={class:"template-card__price","aria-live":"polite"},nt={key:0,style:{"text-align":"right"}},at={style:{"font-size":"0.9rem",color:"#64748b","text-decoration":"line-through"}},st={style:{"font-size":"1.2rem","font-weight":"700",color:"#f97315"}},it={style:{"font-size":"0.8rem",color:"#065f46"}},ot={key:0},rt={class:"template-card__description"},lt={class:"template-card__features"},ct=40,j="0%",ut={__name:"TemplateCard",props:{template:{type:Object,required:!0}},emits:["view"],setup(c,{emit:i}){const a=c,u=i;fe();const p=k(!1),d=e=>{const t=Number(e)||0;return Math.round((t+Number.EPSILON)*100)/100},y=e=>{const t=Number(e)||0;return t.toLocaleString("ru-RU",{minimumFractionDigits:t%1===0?0:2,maximumFractionDigits:2})},$=C(()=>{var t,l;const e=((t=a.template)==null?void 0:t.have_html)??((l=a.template)==null?void 0:l.haveHtml);return typeof e<"u"?!!e:typeof window<"u"?!!(window!=null&&window.have_html):!1}),S=C(()=>d(a.template.price??a.template.price_cents??0)),M=C(()=>{const e=a.template.discount_percent??a.template.discountPercent??a.template.discount??0;return Number.isFinite(Number(e))?d(Number(e)):0}),B=C(()=>d(a.template.discount_amount??a.template.discountAmount??a.template.discount_amount_cents??0)),D=C(()=>B.value>0?d(B.value):M.value>0?d(S.value*M.value/100):0),W=C(()=>{const e=S.value-D.value;return d(e>0?e:0)}),X=async e=>{await he({path:"/buy-template/"+e})},Y=(e,t)=>{u("view",a.template),e&&window.open(e,"_blank","noopener,noreferrer")},w=k(null),x=k(null);let h=null,_=0,F=0,E=1,g=0,A=!1,L=!1;const T={x:null,y:null},n=()=>{const e=w.value,t=x.value;if(!e||!t){g=0;return}const l=e.naturalWidth||e.width,P=e.naturalHeight||e.height,oe=t.clientWidth,J=t.clientHeight;if(!l||!P||!oe||!J){g=0;return}const ue=Math.max(oe/l,J/P),de=P*ue;g=Math.max(0,Math.round(de-J)),g<=0&&(F=0,e.style.objectPosition=`${j} 0%`,e.style.transform="")},m=e=>{const t=w.value;if(t)if(g>0){const l=Math.min(100,Math.max(0,e/g*100));t.style.objectPosition=`${j} ${l}%`}else t.style.objectPosition=`${j} 0%`,t.style.transform=""},v=e=>{if(!A)return;if(L){h=requestAnimationFrame(v);return}_||(_=e);const t=e-_;_=e;const l=ct*t/1e3*E;let P=F+l;P>=g?(P=g,E=-1):P<=0&&(P=0,E=1),F=P,m(F),h=requestAnimationFrame(v)},N=()=>{try{if(!x.value||T.x==null)return!1;const t=document.elementFromPoint(T.x,T.y);if(!t)return!1;const l=t.closest&&t.closest('button, a, input, textarea, [role="button"], label');return!(!l||l.classList&&l.classList.contains("template-card__view-button"))}catch{return!1}},H=e=>{T.x=e.clientX,T.y=e.clientY;const t=N();t&&A&&!L?L=!0:!t&&L&&(L=!1,_=0)},q=async e=>{e&&e.clientX!=null&&(T.x=e.clientX,T.y=e.clientY),await ne(),n();const t=w.value;if(g<=0){if(t&&!t.complete){const l=()=>{t.removeEventListener("load",l),n(),g>0&&x.value&&x.value.matches(":hover")&&requestAnimationFrame(()=>q())};t.addEventListener("load",l,{once:!0})}return}t&&(t._tmpl_return_end&&(t.removeEventListener("transitionend",t._tmpl_return_end),t._tmpl_return_end=null),t.style.transition="none"),F=0,E=1,m(0),L=N(),h&&cancelAnimationFrame(h),A=!0,_=0,h=requestAnimationFrame(v)},Z=()=>{A=!1,L=!1,h&&(cancelAnimationFrame(h),h=null);const e=w.value;if(!e)return;if(F===0){e.style.transition="",e.style.willChange="",F=0,E=1,_=0;return}e.style.transition="object-position 600ms cubic-bezier(.22,.9,.35,1), transform 600ms cubic-bezier(.22,.9,.35,1)",e.style.objectPosition=`${j} 0%`,e.style.transform="",e._tmpl_return_end&&e.removeEventListener("transitionend",e._tmpl_return_end);const t=l=>{(!l.propertyName||l.propertyName.includes("object")||l.propertyName.includes("transform"))&&(e.style.transition="",e.style.willChange="",F=0,E=1,_=0,e.removeEventListener("transitionend",t),e._tmpl_return_end=null)};e._tmpl_return_end=t,e.addEventListener("transitionend",t)},se=e=>q(e),ie=()=>Z();return ae(()=>{const e=w.value,t=x.value;e&&(e.style.objectPosition=`${j} 0%`,e.style.willChange="object-position",e.complete?n():e.addEventListener("load",n)),t&&(t.addEventListener("pointerenter",se),t.addEventListener("pointerleave",ie),t.addEventListener("pointermove",H)),window.addEventListener("resize",n)}),te(()=>{h&&cancelAnimationFrame(h);const e=w.value,t=x.value;e&&e.removeEventListener("load",n),t&&(t.removeEventListener("pointerenter",se),t.removeEventListener("pointerleave",ie),t.removeEventListener("pointermove",H)),window.removeEventListener("resize",n)}),(e,t)=>(r(),o("div",Ye,[s("div",{class:"template-card__image",ref_key:"imageWrapperRef",ref:x},[s("img",{ref_key:"imageRef",ref:w,src:c.template.preview,alt:c.template.title,loading:"lazy",draggable:"false"},null,8,Ke),s("div",We,[$.value?(r(),o("div",Xe,"Заказной")):I("",!0),c.template.popular?(r(),o("div",Ze,"Популярный")):I("",!0)]),s("button",{class:"template-card__view-button",type:"button","aria-label":"Просмотреть шаблон",onClick:t[0]||(t[0]=ee(l=>Y(c.template.preview),["stop"]))},[t[2]||(t[2]=G(" Просмотреть ")),z(f(we),{class:"open-next__svg"})])],512),s("div",Je,[s("div",Qe,[s("h3",et,b(c.template.title),1),s("div",tt,[D.value>0?(r(),o("div",nt,[s("div",at,b(y(S.value))+" ₽",1),s("div",st,b(y(W.value))+" ₽",1),s("div",it,[t[3]||(t[3]=G("Скидка: ")),M.value>0?(r(),o("span",ot,b(M.value)+"%",1)):I("",!0)])])):(r(),o(O,{key:1},[G(b(y(S.value))+" ₽",1)],64))])]),s("p",rt,b(c.template.description),1),s("div",lt,[(r(!0),o(O,null,U(c.template.features,(l,P)=>(r(),o("span",{key:P,class:"template-card__feature"},b(l),1))),128))]),z(Ue,{class:"template-card__button button button--primary",disabled:p.value,onClick:t[1]||(t[1]=l=>X(c.template.id))},{default:le(()=>[G(b(p.value?"Покупка...":"Купить шаблон"),1)]),_:1},8,["disabled"])])]))}},dt=R(ut,[["__scopeId","data-v-0acd0c35"]]),mt=["aria-busy"],pt={class:"portfolio-grid__container container"},_t={key:0,class:"portfolio-grid__content"},vt={key:1,class:"portfolio-grid__empty"},ft={key:2,class:"portfolio-grid__content"},ht={key:0,class:"portfolio-grid__loading"},V=12,yt="have_html,popular,created_at",gt="desc",bt={__name:"PortfolioGrid",props:{activeFilter:{type:String,required:!0}},setup(c){const i=c,a=ce();k([{id:"all",name:"Все шаблоны"}]);const u=k(null);let p=null;const d=k(!1),y=C(()=>a.loading&&a.templates.length===0),$=k(240);function S(){const n={};return i.activeFilter&&i.activeFilter!=="all"&&(n.type=i.activeFilter),n}async function M(){await ne();try{const n=document.querySelector(".portfolio-grid__content .grid-item");n&&n.offsetHeight&&($.value=n.offsetHeight)}catch{}}async function B({page:n=1,perPage:m=V,filters:v={},append:N=!1}={}){const H={...v};return a.listTemplates({page:n,perPage:m,filters:H,append:N,sortBy:yt,order:gt})}async function D(){try{a.perPage=V;const n=S();await B({page:1,perPage:V,filters:n,append:!1}),await M()}catch(n){console.error("Ошибка загрузки шаблонов:",n)}}async function W(){if(!(a.loading||d.value)&&a.hasMore){d.value=!0,await M();try{const n=S(),m=(Number(a.page)||1)+1;await B({page:m,perPage:V,filters:n,append:!0}),await M()}catch(n){console.warn("Ошибка подгрузки следующей страницы:",n)}finally{d.value=!1}}}const X=n=>{for(const m of n)m.isIntersecting&&W()};function Y(){if(p){try{u.value&&p.unobserve(u.value),p.disconnect()}catch{}p=null}p=new IntersectionObserver(X,{root:null,rootMargin:"300px",threshold:.1}),ne(()=>{u.value&&p.observe(u.value)})}ae(async()=>{await D(),Y()}),te(()=>{if(p){try{u.value&&p.unobserve(u.value),p.disconnect()}catch{}p=null}}),K(()=>i.activeFilter,async()=>{await D(),Y()});const w=C(()=>{const n=a.templates||[];return i.activeFilter==="all"?n:n.filter(m=>String(m.type)===String(i.activeFilter))}),x=k(V),h=k(0);let _=null,F=0,E=0,g=0,A=600;const L=n=>1-Math.pow(1-n,3);function T(n,m=A){_!==null&&(cancelAnimationFrame(_),_=null),F=performance.now(),E=h.value,g=n,A=m;const v=N=>{const H=N-F,q=Math.min(1,H/A),Z=L(q);h.value=Math.round(E+(g-E)*Z),q<1?_=requestAnimationFrame(v):(_=null,h.value=g)};_=requestAnimationFrame(v)}return te(()=>{_!==null&&(cancelAnimationFrame(_),_=null)}),h.value=a.loading?0:w.value.length,K(()=>w.value.length,n=>{a.loading||T(n)}),K(()=>a.loading,(n,m)=>{m===!0&&n===!1&&T(w.value.length)}),(n,m)=>(r(),o("section",{class:"portfolio-grid","aria-busy":y.value?"true":"false"},[s("div",pt,[m[2]||(m[2]=s("div",{class:"portfolio-grid__header"},null,-1)),y.value?(r(),o("div",_t,[(r(!0),o(O,null,U(x.value,v=>(r(),o("div",{key:"skeleton-init-"+v,class:"skeleton-card",role:"status","aria-label":"Загрузка шаблона",style:Q({minHeight:$.value+"px"})},m[0]||(m[0]=[ye('<div class="skeleton-card__thumb shimmer" data-v-e116ba3a></div><div class="skeleton-card__body" data-v-e116ba3a><div class="skeleton-line skeleton-line--title shimmer" data-v-e116ba3a></div><div class="skeleton-line skeleton-line--meta shimmer" data-v-e116ba3a></div><div class="skeleton-line skeleton-line--meta short shimmer" data-v-e116ba3a></div></div>',2)]),4))),128))])):f(a).error?(r(),o("div",vt," Ошибка: "+b(f(a).error),1)):(r(),o("div",ft,[z(ge,{name:"grid",tag:"div",class:"portfolio-grid__content-inner"},{default:le(()=>[(r(!0),o(O,null,U(w.value,(v,N)=>(r(),o("div",{key:v.id,class:"grid-item",style:Q({transitionDelay:`${Math.min(N,20)*30}ms`})},[z(dt,{template:v},null,8,["template"])],4))),128)),d.value?(r(!0),o(O,{key:0},U(x.value,v=>(r(),o("div",{key:"skeleton-more-"+v,class:"grid-item skeleton-placeholder",style:Q({height:$.value+"px",transitionDelay:`${Math.min(w.value.length+v,40)*12}ms`}),"aria-hidden":"true"},m[1]||(m[1]=[s("div",{class:"skeleton-card__thumb shimmer"},null,-1),s("div",{class:"skeleton-card__body"},[s("div",{class:"skeleton-line skeleton-line--title shimmer"}),s("div",{class:"skeleton-line skeleton-line--meta shimmer"})],-1)]),4))),128)):I("",!0)]),_:1}),s("div",{ref_key:"sentinel",ref:u,class:"infinite-sentinel",style:{height:"1px",width:"100%"}},null,512),f(a).loading&&!y.value?(r(),o("div",ht,"Загрузка…")):I("",!0)]))])],8,mt))}},wt=R(bt,[["__scopeId","data-v-e116ba3a"]]),kt={class:"portfolio-page"},$t={__name:"templates",setup(c){const i=k("all");return(a,u)=>(r(),o("div",kt,[z(Oe),z(Ve,{"active-filter":f(i),"onUpdate:activeFilter":u[0]||(u[0]=p=>be(i)?i.value=p:null)},null,8,["active-filter"]),z(wt,{"active-filter":f(i)},null,8,["active-filter"])]))}},Et=R($t,[["__scopeId","data-v-61bc1864"]]);export{Et as default};
