import{_ as x,L as A,K as L,D as P,k as p,M as b,l as U,E as B,c as u,o as c,a,b as E,w as T,d as O,e as q,t as n,f as F,n as M}from"./iHL_0Qvu.js";const z={class:"od-page"},J={class:"od-container"},K={key:0,class:"od-loading"},$={key:1,class:"od-error"},j={key:2,class:"od-empty"},G={key:3,class:"od-card"},H={class:"od-top"},Q=["src"],W={class:"od-info"},X={class:"od-title"},Y={class:"od-meta"},Z={class:"od-price"},ee={class:"od-section"},te={class:"od-grid"},re={class:"od-grid-item"},se={class:"od-grid-item"},ae={class:"od-grid-item"},ie={class:"od-grid-item"},ne={__name:"[id]",setup(oe){const f=A();L();const o=P(),_=p(f.params.id??f.params.orderId??null),v=p(!1),l=p(null),i=p({});b(()=>f.params.id,e=>{_.value=e}),U(async()=>{await g()}),b(_,async(e,t)=>{e!==t&&await g()});function D(e){return e=="pending_payment"||e=="pending_yookassa_payment"?"Ожидает оплаты":e=="in_progress"?"В разработке":e=="completed"?"Оплачен":e=="cancelled"?"Отменен":e}async function g(){var t;const e=_.value;if(!e){l.value="Не указан ID заказа",i.value={};return}v.value=!0,l.value=null;try{let r=null;if(Array.isArray(o.orders)&&(r=o.orders.find(s=>String(s.id??s.order_id??s._id)===String(e))),!r&&typeof o.fetchOrder=="function"){const s=await o.fetchOrder(e);s&&s.success&&s.data?r=s.data:s&&s.order?r=s.order:s&&s.data===void 0&&s.success&&(r=s)}if(!r&&typeof o.fetchUserOrders=="function"){const s=await o.fetchUserOrders({page:1,perPage:1});s&&s.success&&Array.isArray((t=s.data)==null?void 0:t.rows)&&s.data.rows.length>0&&(r=s.data.rows.find(d=>String(d.id??d.order_id??d._id)===String(e)))}if(!r){l.value="Не удалось найти заказ",i.value={};return}i.value=C(r)}catch(r){console.error("OrderDetailsPage loadOrder error",r),l.value=(r==null?void 0:r.message)??"Сетевая ошибка",i.value={}}finally{v.value=!1}}function C(e){var t,r;return e?{id:e.id??e.order_id??e._id??null,date:y(e),template:((t=e.template)==null?void 0:t.title)??((r=e.template)==null?void 0:r.name)??e.template_title??e.templateName??(typeof e.template=="string"?e.template:null)??"—",status:e.status??e.state??"—",statusCode:String(e.status??e.state??"").toLowerCase().replace(/\s+/g,"_")||"unknown",price:R(e),preview:I(e),raw:e}:{}}function I(e){var r,s,d,w,h,S,N,k;if(!e)return null;const t=[e.preview,(r=e.template)==null?void 0:r.image,(s=e.template)==null?void 0:s.preview,e.template_image,e.template_preview,e.image,(w=(d=e.raw)==null?void 0:d.template)==null?void 0:w.image,(S=(h=e.raw)==null?void 0:h.template)==null?void 0:S.preview,(N=e.raw)==null?void 0:N.template_image,(k=e.raw)==null?void 0:k.preview];for(const m of t)if(m&&typeof m=="string"&&m.trim()!=="")return m;return null}function R(e){const t=e.price??e.amount??e.total,r=e.currency??e.currency_code??"RUB";if(typeof t=="number"&&!Number.isNaN(t))try{return new Intl.NumberFormat("ru-RU",{style:"currency",currency:r}).format(t)}catch{return String(t)}return t??"—"}function y(e){if(!e)return"";const t=e.created_at??e.createdAt??e.date??e.order_date??e.created??e;let r;if(t instanceof Date)r=t;else if(typeof t=="number"){const s=t<1e12&&t<1e10?t*1e3:t;r=new Date(s)}else r=new Date(String(t));return Number.isNaN(r.getTime())?String(t??""):r.toLocaleString("ru-RU",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}function V(e){e.target.style.display="none"}return B(()=>{var e,t;try{return JSON.stringify(((e=i.value)==null?void 0:e.raw)??{},null,2)}catch{return String(((t=i.value)==null?void 0:t.raw)??"")}}),(e,t)=>{const r=q;return c(),u("div",z,[a("div",J,[E(r,{to:"/profile?tab=orders",class:"od-back"},{default:T(()=>t[0]||(t[0]=[O("← Мои заказы")])),_:1,__:[0]}),v.value?(c(),u("div",K,"Загрузка заказа...")):l.value?(c(),u("div",$,[O(" Ошибка: "+n(l.value)+" ",1),a("div",{style:{"margin-top":"1rem"}},[a("button",{class:"od-btn",onClick:g},"Повторить")])])):!i.value||!i.value.id?(c(),u("div",j,"Заказ не найден")):(c(),u("div",G,[a("div",H,[i.value.raw.template.preview?(c(),u("img",{key:0,src:i.value.raw.template.preview,class:"od-thumb",onError:V,alt:"Превью шаблона"},null,40,Q)):F("",!0),a("div",W,[a("h1",X,n(i.value.raw.domain.fqdn??"—"),1),a("div",Y,"Дата: "+n(y(i.value.raw)),1),a("div",{class:M(["od-meta",["profile-orders__status",`profile-orders__status--${i.value.statusCode}`]])},"Статус: "+n(D(i.value.status)),3),a("div",Z,n(i.value.price),1)])]),a("section",ee,[t[5]||(t[5]=a("h2",{class:"od-section-title"},"Детали заказа",-1)),a("div",te,[a("div",re,[t[1]||(t[1]=a("strong",null,"ID",-1)),a("div",null,n(i.value.id??"—"),1)]),a("div",se,[t[2]||(t[2]=a("strong",null,"Шаблон",-1)),a("div",null,n(i.value.template??"—"),1)]),a("div",ae,[t[3]||(t[3]=a("strong",null,"Домен",-1)),a("div",null,n(i.value.raw.domain.fqdn??"—"),1)]),a("div",ie,[t[4]||(t[4]=a("strong",null,"Сумма",-1)),a("div",null,n(i.value.price),1)])])]),t[6]||(t[6]=a("div",{class:"od-actions"},null,-1))]))])])}}},de=x(ne,[["__scopeId","data-v-72d170a4"]]);export{de as default};
