import{_ as x,L,K as A,D as B,k as d,M as b,E as m,l as R,c as U,o as V,a as o,d as _,t as q,b as C,w as M,e as P}from"./D_JQTfwH.js";const T={class:"success-page"},E={class:"success-card",role:"main","aria-labelledby":"success-title"},F={class:"subtitle"},j={class:"accent"},J={class:"controls"},K={__name:"success",setup(z){const f=L();A();const s=(()=>{try{return B()}catch{return null}})(),c=d(String(f.query.orderId??f.params.orderId??"")||"");b(()=>f.query.orderId,e=>{c.value=String(e??"")});const g=d(!1),p=d(null),n=d({});m(()=>!!(n.value&&n.value.id));const N=m(()=>c.value||(n.value.id??"—"));R(()=>{v()}),b(c,(e,t)=>{e!==t&&v()});async function v(){var t;const e=c.value;if(p.value=null,n.value={},!!e){g.value=!0;try{let r=null;if(s&&Array.isArray(s.orders)&&(r=s.orders.find(a=>String(a.id??a.order_id??a._id)===String(e))),!r&&s&&typeof s.fetchOrder=="function"){const a=await s.fetchOrder(e);a!=null&&a.success&&a.data?r=a.data:a!=null&&a.order?r=a.order:a&&a.id&&(r=a)}if(!r&&s&&typeof s.fetchUserOrders=="function"){const a=await s.fetchUserOrders({page:1,perPage:10});a!=null&&a.success&&Array.isArray((t=a.data)==null?void 0:t.rows)&&(r=a.data.rows.find(i=>String(i.id??i.order_id??i._id)===String(e)))}if(!r){p.value="Не удалось найти заказ в системе.",n.value={};return}n.value=k(r)}catch(r){console.error("success page loadOrder error",r),p.value=(r==null?void 0:r.message)??String(r)??"Сетевая ошибка",n.value={}}finally{g.value=!1}}}function k(e){var i,l;if(!e)return{};const t=e.id??e.order_id??e._id??null,r=e.status??e.state??"—",a=String(r).toLowerCase().replace(/\s+/g,"_")||"unknown";return{id:t,date:I(e),template:((i=e.template)==null?void 0:i.title)??((l=e.template)==null?void 0:l.name)??e.template_title??(typeof e.template=="string"?e.template:"—"),status:r,statusCode:a,price:D(e),preview:O(e),raw:e}}function O(e){var r,a,i,l,y,w,S,h;if(!e)return null;const t=[e.preview,(r=e.template)==null?void 0:r.image,(a=e.template)==null?void 0:a.preview,e.template_image,e.template_preview,e.image,(l=(i=e.raw)==null?void 0:i.template)==null?void 0:l.image,(w=(y=e.raw)==null?void 0:y.template)==null?void 0:w.preview,(S=e.raw)==null?void 0:S.template_image,(h=e.raw)==null?void 0:h.preview];for(const u of t)if(u&&typeof u=="string"&&u.trim()!=="")return u;return null}function D(e){const t=e.price??e.amount??e.total,r=e.currency??e.currency_code??"RUB";if(typeof t=="number"&&!Number.isNaN(t))try{return new Intl.NumberFormat("ru-RU",{style:"currency",currency:r}).format(t)}catch{return String(t)}return t??"—"}function I(e){if(!e)return"";const t=e.created_at??e.createdAt??e.date??e.order_date??e.created??e;let r;if(t instanceof Date)r=t;else if(typeof t=="number"){const a=t<1e12&&t<1e10?t*1e3:t;r=new Date(a)}else r=new Date(String(t));return Number.isNaN(r.getTime())?String(t??""):r.toLocaleString("ru-RU",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}return m(()=>{var e,t;try{return JSON.stringify(((e=n.value)==null?void 0:e.raw)??{},null,2)}catch{return String(((t=n.value)==null?void 0:t.raw)??"")}}),(e,t)=>{const r=P;return V(),U("div",T,[o("main",E,[t[3]||(t[3]=o("div",{class:"icon-wrap","aria-hidden":"true"},[o("svg",{viewBox:"0 0 24 24",class:"check-icon"},[o("path",{d:"M20 6L9 17l-5-5",fill:"none",stroke:"white","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),t[4]||(t[4]=o("h1",{id:"success-title",class:"title"},"Спасибо за покупку!",-1)),o("p",F,[t[0]||(t[0]=_(" Ваш заказ ")),o("span",j,q(N.value),1),t[1]||(t[1]=_(" успешно оформлен. "))]),o("div",J,[C(r,{class:"btn btn-link",to:"/profile?tab=orders"},{default:M(()=>t[2]||(t[2]=[_("Мои заказы")])),_:1,__:[2]})])])])}}},H=x(K,[["__scopeId","data-v-7662d048"]]);export{H as default};
