import{_ as U,s as j,q as A,p as D,i as r,y as a,j as R,z,c as o,o as l,a as s,g as d,t as G,B as g,h as V,v as B,K,d as L,G as T}from"./xo8e5jVH.js";const O={class:"auth-page"},Q={class:"auth-card",role:"main"},$={key:0,class:"auth-error",role:"alert"},F={key:1,class:"auth-error",role:"alert"},H={class:"auth-field"},J=["disabled"],W={class:"auth-field"},X=["disabled"],Y={class:"auth-actions"},Z=["disabled","aria-disabled"],ee={key:0},se={key:1},te=["disabled"],ae={key:3,class:"auth-success"},oe={key:4,class:"auth-field__hint"},le={key:5,class:"auth-field__hint"},ue={__name:"reset-password",setup(ne){const M=j();A();const h=D(),p=r(""),f=r(""),n=r(!1),t=r(null),y=r(!1),S=r(null);function v(u){const e=M.query[u];return Array.isArray(e)?e[0]:e??null}const C=a(()=>v("token")||v("resetToken")),P=a(()=>v("uid")||v("user")||v("uidb64")),c=a(()=>!C.value||!P.value),i=a(()=>(p.value??"").trim()),m=a(()=>(f.value??"").trim()),_=a(()=>i.value.length>0&&i.value.length<8),q=a(()=>!i.value||!m.value),w=a(()=>!!i.value&&!!m.value&&i.value!==m.value),b=a(()=>!n.value&&!c.value&&!q.value&&!_.value&&!w.value);function x(){t.value=null}async function E(){var u;if(!b.value){c.value?t.value="Отсутствует token или uid в query-параметрах.":q.value?t.value="Заполните оба поля.":_.value?t.value="Пароль должен содержать минимум 8 символов.":w.value&&(t.value="Пароли не совпадают.");return}x(),n.value=!0;try{const e={uid:P.value,token:C.value,newPassword:i.value};h&&typeof h.resetPassword=="function"?await h.resetPassword(e):await $fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:e}),y.value=!0,p.value="",f.value="",setTimeout(async()=>await T({path:"/"}),1200)}catch(e){t.value=((u=e==null?void 0:e.data)==null?void 0:u.message)||(e==null?void 0:e.message)||"Ошибка при сбросе пароля. Проверьте ссылку или попробуйте позже."}finally{n.value=!1}}async function I(){await T({path:"/"})}async function N(){await T({path:"/profile"})}return R(()=>{c.value||setTimeout(()=>{var u;return(u=S.value)==null?void 0:u.focus()},50)}),z([i,m],()=>{t.value&&x()}),(u,e)=>(l(),o("div",O,[s("main",Q,[e[7]||(e[7]=s("h1",{class:"auth-title"},"Сброс пароля",-1)),t.value?(l(),o("div",$,G(t.value),1)):d("",!0),c.value?(l(),o("div",F," Невозможно выполнить сброс ")):d("",!0),!y.value&&!c.value?(l(),o("form",{key:2,class:"auth-form",onSubmit:g(E,["prevent"]),novalidate:""},[s("label",H,[e[4]||(e[4]=s("span",{class:"auth-label"},"Новый пароль",-1)),V(s("input",{ref_key:"passwordInput",ref:S,"onUpdate:modelValue":e[0]||(e[0]=k=>p.value=k),type:"password",required:"",autocomplete:"new-password",disabled:n.value,onKeydown:e[1]||(e[1]=K(g(()=>{},["prevent"]),["enter"])),minlength:"8"},null,40,J),[[B,p.value]])]),s("label",W,[e[5]||(e[5]=s("span",{class:"auth-label"},"Подтвердите пароль",-1)),V(s("input",{"onUpdate:modelValue":e[2]||(e[2]=k=>f.value=k),type:"password",required:"",autocomplete:"new-password",disabled:n.value,onKeydown:e[3]||(e[3]=K(g(()=>{},["prevent"]),["enter"])),minlength:"8"},null,40,X),[[B,f.value]])]),s("div",Y,[s("button",{type:"submit",class:"button button--primary",disabled:!b.value,"aria-disabled":!b.value},[n.value?(l(),o("span",se,"Сохранение...")):(l(),o("span",ee,"Сохранить новый пароль"))],8,Z),s("button",{type:"button",class:"button",onClick:I,disabled:n.value},"Отмена",8,te)])],32)):d("",!0),y.value?(l(),o("div",ae,[e[6]||(e[6]=L(" Пароль успешно изменён. Вы будете перенаправлены на страницу входа. ")),s("div",{style:{"margin-top":"0.5rem"}},[s("button",{class:"button button--primary",onClick:N},"Перейти к входу")])])):d("",!0),_.value?(l(),o("div",oe,"Пароль должен быть не менее 8 символов.")):d("",!0),w.value?(l(),o("div",le,"Пароли не совпадают.")):d("",!0)])]))}},re=U(ue,[["__scopeId","data-v-2b24ea9b"]]);export{re as default};
