import{_ as q,n as F,s as Y,C as R,c as i,o,a as n,k as N,t as v,p as X,l as ce,v as de,D as ue,x as _,d as S,F as T,r as D,y as me,q as pe,E as C,G as oe,b as j,w as _e,H as ve,I as fe,m as ne,B as he,J as ye}from"./yK3Y99Sc.js";import{u as ie}from"./mC9b7CpF.js";import ge from"./MWox3Swj.js";import{B as be}from"./C3CvXEfx.js";const ke={class:"portfolio-hero"},we={class:"portfolio-hero__container container"},$e={class:"portfolio-hero__content"},Fe={class:"search-wrap"},Pe=["onKeyup"],xe=["disabled"],Te={key:0},Ee={key:1},Le={key:0,class:"portfolio-hero__meta"},Ae={class:"meta-count"},Ce={key:0,class:"meta-loading"},Se={key:1,class:"meta-error"},Ne="Выберите подходящий шаблон",Ie="",Me=300,Be={__name:"PortfolioHero",setup(d){const s=ie(),a=F(""),y=F(null);Y(async()=>{try{await s.listTemplates({page:1,perPage:12,filters:{}})}catch{}}),R(a,u=>{y.value&&clearTimeout(y.value),y.value=setTimeout(async()=>{if(!u||String(u).trim()===""){await s.listTemplates({page:1,perPage:12,filters:{}});return}try{await s.listTemplates({page:1,perPage:12,filters:{search:u}})}catch{}},Me)});async function b(){y.value&&(clearTimeout(y.value),y.value=null);try{await s.listTemplates({page:1,perPage:12,filters:{search:a.value}})}catch{}}return(u,f)=>(o(),i("section",ke,[n("div",we,[n("div",$e,[n("h1",{class:"portfolio-hero__title"},v(Ne)),n("p",{class:"portfolio-hero__subtitle"},v(Ie)),n("form",{class:"portfolio-hero__search",onSubmit:X(b,["prevent"]),"aria-label":"Поиск шаблонов"},[n("div",Fe,[ce(n("input",{"onUpdate:modelValue":f[0]||(f[0]=h=>a.value=h),onKeyup:ue(X(b,["prevent"]),["enter"]),type:"search",placeholder:"Найти шаблон...",class:"portfolio-hero__input","aria-label":"Поиск шаблонов"},null,40,Pe),[[de,a.value]]),n("button",{type:"submit",class:"btn-search",disabled:_(s).loading},[_(s).loading?(o(),i("span",Te,"Поиск...")):(o(),i("span",Ee,"Найти"))],8,xe)])],32),_(s).templates&&_(s).templates.length>=0?(o(),i("div",Le,[n("span",Ae,[f[1]||(f[1]=S(" Найдено: ")),n("strong",null,v(_(s).total??_(s).templates.length),1)]),_(s).loading?(o(),i("span",Ce," · загружается…")):N("",!0),_(s).error?(o(),i("span",Se," · Ошибка: "+v(_(s).error),1)):N("",!0)])):N("",!0)])])]))}},je=q(Be,[["__scopeId","data-v-9aae542a"]]),qe={class:"portfolio-filters"},ze={class:"portfolio-filters__container container"},De={class:"portfolio-filters__wrapper"},Oe=["onClick"],Re={__name:"PortfolioFilters",props:{activeFilter:{type:String,required:!0}},emits:["update:activeFilter"],setup(d,{emit:s}){const a=s,y=F([{id:"all",name:"Все шаблоны"}]),b=u=>{a("update:activeFilter",u)};return(u,f)=>(o(),i("section",qe,[n("div",ze,[n("div",De,[(o(!0),i(T,null,D(_(y),h=>(o(),i("button",{key:h.id,class:me(["portfolio-filters__button",{"portfolio-filters__button--active":d.activeFilter===h.id}]),onClick:P=>b(h.id)},v(h.name),11,Oe))),128))])])]))}},He=q(Re,[["__scopeId","data-v-4e78344b"]]),Ve={class:"template-card",role:"group",tabindex:"0"},Ue=["src","alt"],We={class:"template-card__badges"},Xe={key:0,class:"template-card__badge template-card__badge--custom"},Ye={key:1,class:"template-card__badge template-card__badge--popular"},Ge={class:"template-card__content"},Ke={class:"template-card__header"},Je={class:"template-card__title"},Ze={class:"template-card__price","aria-live":"polite"},Qe={key:0,style:{"text-align":"right"}},et={style:{"font-size":"0.9rem",color:"#64748b","text-decoration":"line-through"}},tt={style:{"font-size":"1.2rem","font-weight":"700",color:"#f97315"}},nt={style:{"font-size":"0.8rem",color:"#065f46"}},at={key:0},ot={class:"template-card__description"},it={class:"template-card__features"},st=40,z="0%",lt={__name:"TemplateCard",props:{template:{type:Object,required:!0}},emits:["view"],setup(d,{emit:s}){const a=d,y=s;pe();const b=F(!1),u=e=>{const t=Number(e)||0;return Math.round((t+Number.EPSILON)*100)/100},f=e=>{const t=Number(e)||0;return t.toLocaleString("ru-RU",{minimumFractionDigits:t%1===0?0:2,maximumFractionDigits:2})},h=C(()=>{var t,r;const e=((t=a.template)==null?void 0:t.inline_build)??((r=a.template)==null?void 0:r.inlineBuild);return typeof e<"u"?!!e:typeof window<"u"?!!(window!=null&&window.inline_build):!1}),P=C(()=>u(a.template.price??a.template.price_cents??0)),x=C(()=>{const e=a.template.discount_percent??a.template.discountPercent??a.template.discount??0;return Number.isFinite(Number(e))?u(Number(e)):0}),I=C(()=>u(a.template.discount_amount??a.template.discountAmount??a.template.discount_amount_cents??0)),M=C(()=>I.value>0?u(I.value):x.value>0?u(P.value*x.value/100):0),H=C(()=>{const e=P.value-M.value;return u(e>0?e:0)}),O=async e=>{await fe({path:"/buy-template/"+e})},V=(e,t)=>{y("view",a.template),e&&window.open(e,"_blank","noopener,noreferrer")},l=F(null),c=F(null);let m=null,g=0,p=0,$=1,k=0,B=!1,E=!1;const L={x:null,y:null},A=()=>{const e=l.value,t=c.value;if(!e||!t){k=0;return}const r=e.naturalWidth||e.width,w=e.naturalHeight||e.height,te=t.clientWidth,W=t.clientHeight;if(!r||!w||!te||!W){k=0;return}const le=Math.max(te/r,W/w),re=w*le;k=Math.max(0,Math.round(re-W)),k<=0&&(p=0,e.style.objectPosition=`${z} 0%`,e.style.transform="")},G=e=>{const t=l.value;if(t)if(k>0){const r=Math.min(100,Math.max(0,e/k*100));t.style.objectPosition=`${z} ${r}%`}else t.style.objectPosition=`${z} 0%`,t.style.transform=""},U=e=>{if(!B)return;if(E){m=requestAnimationFrame(U);return}g||(g=e);const t=e-g;g=e;const r=st*t/1e3*$;let w=p+r;w>=k?(w=k,$=-1):w<=0&&(w=0,$=1),p=w,G(p),m=requestAnimationFrame(U)},K=()=>{try{if(!c.value||L.x==null)return!1;const t=document.elementFromPoint(L.x,L.y);if(!t)return!1;const r=t.closest&&t.closest('button, a, input, textarea, [role="button"], label');return!(!r||r.classList&&r.classList.contains("template-card__view-button"))}catch{return!1}},J=e=>{L.x=e.clientX,L.y=e.clientY;const t=K();t&&B&&!E?E=!0:!t&&E&&(E=!1,g=0)},Z=async e=>{e&&e.clientX!=null&&(L.x=e.clientX,L.y=e.clientY),await ve(),A();const t=l.value;if(k<=0){if(t&&!t.complete){const r=()=>{t.removeEventListener("load",r),A(),k>0&&c.value&&c.value.matches(":hover")&&requestAnimationFrame(()=>Z())};t.addEventListener("load",r,{once:!0})}return}t&&(t._tmpl_return_end&&(t.removeEventListener("transitionend",t._tmpl_return_end),t._tmpl_return_end=null),t.style.transition="none"),p=0,$=1,G(0),E=K(),m&&cancelAnimationFrame(m),B=!0,g=0,m=requestAnimationFrame(U)},se=()=>{B=!1,E=!1,m&&(cancelAnimationFrame(m),m=null);const e=l.value;if(!e)return;if(p===0){e.style.transition="",e.style.willChange="",p=0,$=1,g=0;return}e.style.transition="object-position 600ms cubic-bezier(.22,.9,.35,1), transform 600ms cubic-bezier(.22,.9,.35,1)",e.style.objectPosition=`${z} 0%`,e.style.transform="",e._tmpl_return_end&&e.removeEventListener("transitionend",e._tmpl_return_end);const t=r=>{(!r.propertyName||r.propertyName.includes("object")||r.propertyName.includes("transform"))&&(e.style.transition="",e.style.willChange="",p=0,$=1,g=0,e.removeEventListener("transitionend",t),e._tmpl_return_end=null)};e._tmpl_return_end=t,e.addEventListener("transitionend",t)},Q=e=>Z(e),ee=()=>se();return Y(()=>{const e=l.value,t=c.value;e&&(e.style.objectPosition=`${z} 0%`,e.style.willChange="object-position",e.complete?A():e.addEventListener("load",A)),t&&(t.addEventListener("pointerenter",Q),t.addEventListener("pointerleave",ee),t.addEventListener("pointermove",J)),window.addEventListener("resize",A)}),oe(()=>{m&&cancelAnimationFrame(m);const e=l.value,t=c.value;e&&e.removeEventListener("load",A),t&&(t.removeEventListener("pointerenter",Q),t.removeEventListener("pointerleave",ee),t.removeEventListener("pointermove",J)),window.removeEventListener("resize",A)}),(e,t)=>(o(),i("div",Ve,[n("div",{class:"template-card__image",ref_key:"imageWrapperRef",ref:c},[n("img",{ref_key:"imageRef",ref:l,src:d.template.image,alt:d.template.title,loading:"lazy",draggable:"false"},null,8,Ue),n("div",We,[h.value?N("",!0):(o(),i("div",Xe,"Заказной")),d.template.popular?(o(),i("div",Ye,"Популярный")):N("",!0)]),n("button",{class:"template-card__view-button",type:"button","aria-label":"Просмотреть шаблон",onClick:t[0]||(t[0]=X(r=>V(d.template.preview),["stop"]))},[t[2]||(t[2]=S(" Просмотреть ")),j(_(ge),{class:"open-next__svg"})])],512),n("div",Ge,[n("div",Ke,[n("h3",Je,v(d.template.title),1),n("div",Ze,[M.value>0?(o(),i("div",Qe,[n("div",et,v(f(P.value))+" ₽",1),n("div",tt,v(f(H.value))+" ₽",1),n("div",nt,[t[3]||(t[3]=S("Скидка: ")),x.value>0?(o(),i("span",at,v(x.value)+"%",1)):N("",!0)])])):(o(),i(T,{key:1},[S(v(f(P.value))+" ₽",1)],64))])]),n("p",ot,v(d.template.description),1),n("div",it,[(o(!0),i(T,null,D(d.template.features,(r,w)=>(o(),i("span",{key:w,class:"template-card__feature"},v(r),1))),128))]),j(be,{class:"template-card__button button button--primary",disabled:b.value,onClick:t[1]||(t[1]=r=>O(d.template.id))},{default:_e(()=>[S(v(b.value?"Покупка...":"Купить шаблон"),1)]),_:1},8,["disabled"])])]))}},rt=q(lt,[["__scopeId","data-v-3f299b97"]]),ct=["aria-busy"],dt={class:"portfolio-grid__container container"},ut={class:"portfolio-grid__header"},mt={class:"portfolio-grid__title"},pt={key:2},_t={key:3},vt={class:"portfolio-grid__loading-hint"},ft={key:0,class:"portfolio-grid__content"},ht={key:1,class:"portfolio-grid__empty"},yt={key:2,class:"portfolio-grid__content"},gt={key:3,class:"portfolio-grid__content"},ae=12,bt={__name:"PortfolioGrid",props:{activeFilter:{type:String,required:!0}},setup(d){const s=d,a=ie(),y=F([{id:"all",name:"Все шаблоны"}]),b=async()=>{try{const l={};s.activeFilter&&s.activeFilter!=="all"&&(l.type=s.activeFilter),await a.listTemplates({page:1,perPage:12,filters:l})}catch(l){console.error("Ошибка загрузки шаблонов:",l)}};Y(async()=>{await b()}),R(()=>s.activeFilter,async()=>{await b()});const u=C(()=>{const l=a.templates||[];return s.activeFilter==="all"?l:l.filter(c=>String(c.type)===String(s.activeFilter))}),f=F(0);let h=null,P=0,x=0,I=0,M=600;const H=l=>1-Math.pow(1-l,3);function O(l,c=M){h!==null&&(cancelAnimationFrame(h),h=null),P=performance.now(),x=f.value,I=l,M=c;const m=g=>{const p=g-P,$=Math.min(1,p/M),k=H($),B=Math.round(x+(I-x)*k);f.value=B,$<1?h=requestAnimationFrame(m):(h=null,f.value=I)};h=requestAnimationFrame(m)}oe(()=>{h!==null&&(cancelAnimationFrame(h),h=null)});function V(l){const c=l%10,m=l%100;return c===1&&m!==11?"шаблон":c>=2&&c<=4&&!(m>=12&&m<=14)?"шаблона":"шаблонов"}return a.loading?f.value=0:f.value=u.value.length,R(()=>u.value.length,(l,c)=>{a.loading||O(l)}),R(()=>a.loading,(l,c)=>{if(c===!0&&l===!1){const m=u.value.length;O(m)}}),(l,c)=>{var m,g;return o(),i("section",{class:"portfolio-grid","aria-busy":_(a).loading?"true":"false"},[n("div",dt,[n("div",ut,[n("h2",mt,[_(a).loading?(o(),i(T,{key:0},[S("… шаблонов")],64)):(o(),i(T,{key:1},[S(v(f.value)+" "+v(V(f.value)),1)],64)),!_(a).loading&&d.activeFilter!=="all"?(o(),i("span",pt,' в категории "'+v(((m=y.value.find(p=>p.id===d.activeFilter))==null?void 0:m.name)||d.activeFilter)+'" ',1)):_(a).loading&&d.activeFilter!=="all"?(o(),i("span",_t,[n("small",vt,"в категории «"+v(((g=y.value.find(p=>p.id===d.activeFilter))==null?void 0:g.name)||d.activeFilter)+"»",1)])):N("",!0)])]),_(a).loading?(o(),i("div",ft,[(o(),i(T,null,D(ae,p=>n("div",{key:"skeleton-loading-"+p,class:"skeleton-card",role:"status","aria-label":"Загрузка шаблона"},c[0]||(c[0]=[ne('<div class="skeleton-card__thumb shimmer" data-v-1d275d61></div><div class="skeleton-card__body" data-v-1d275d61><div class="skeleton-line skeleton-line--title shimmer" data-v-1d275d61></div><div class="skeleton-line skeleton-line--meta shimmer" data-v-1d275d61></div><div class="skeleton-line skeleton-line--meta short shimmer" data-v-1d275d61></div></div>',2)]))),64))])):_(a).error?(o(),i("div",ht," Ошибка: "+v(_(a).error),1)):u.value.length===0?(o(),i("div",yt,[(o(),i(T,null,D(ae,p=>n("div",{key:"skeleton-empty-"+p,class:"skeleton-card",role:"status","aria-label":"Пустая карта шаблона — заглушка"},c[1]||(c[1]=[ne('<div class="skeleton-card__thumb shimmer" data-v-1d275d61></div><div class="skeleton-card__body" data-v-1d275d61><div class="skeleton-line skeleton-line--title shimmer" data-v-1d275d61></div><div class="skeleton-line skeleton-line--meta shimmer" data-v-1d275d61></div><div class="skeleton-line skeleton-line--meta short shimmer" data-v-1d275d61></div></div>',2)]))),64))])):(o(),i("div",gt,[(o(!0),i(T,null,D(u.value,p=>(o(),he(rt,{key:p.id,template:p},null,8,["template"]))),128))]))])],8,ct)}}},kt=q(bt,[["__scopeId","data-v-1d275d61"]]),wt={class:"portfolio-cta"},$t="Нужен уникальный дизайн?",Ft="Разработаем эксклюзивный сайт специально для вас",Pt={__name:"PortfolioCTA",setup(d){return(s,a)=>(o(),i("section",wt,[n("div",{class:"portfolio-cta__container container"},[n("div",{class:"portfolio-cta__content"},[n("h2",{class:"portfolio-cta__title"},v($t)),n("p",{class:"portfolio-cta__subtitle"},v(Ft)),a[0]||(a[0]=n("button",{class:"portfolio-cta__button button button--primary"}," Заказать дизайн ",-1))])])]))}},xt=q(Pt,[["__scopeId","data-v-f329e64b"]]),Tt={class:"portfolio-page"},Et={__name:"templates",setup(d){const s=F("all");return(a,y)=>(o(),i("div",Tt,[j(je),j(He,{"active-filter":_(s),"onUpdate:activeFilter":y[0]||(y[0]=b=>ye(s)?s.value=b:null)},null,8,["active-filter"]),j(kt,{"active-filter":_(s)},null,8,["active-filter"]),j(xt)]))}},Nt=q(Et,[["__scopeId","data-v-5442f79c"]]);export{Nt as default};
