{"version":3,"file":"admin-DycVp_oZ.js","sources":["../../../../stores/landing.js","../../../../pages/admin.vue"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { API } from '~/config'\n\nexport const useLandingStore = defineStore('landing', {\n  state: () => ({\n    loading: false,\n    error: null,\n    landings: [],\n    landing: null\n  }),\n\n  getters: {\n    isLoading(state) {\n      return state.loading\n    },\n    hasError(state) {\n      return !!state.error\n    }\n  },\n\n  actions: {\n    async parseResponse(res) {\n      const json = await res.json().catch(() => null)\n      if (!res.ok) {\n        const msg = (json && (json.data || json.description || json.message)) || res.statusText || 'Network error'\n        throw new Error(msg)\n      }\n      if (json && (json.status === '200' || json.status === 200)) {\n        return json.data\n      }\n      return json && json.data !== undefined ? json.data : json\n    },\n\n    async addLandingSettings(payload) {\n      this.loading = true\n      this.error = null\n      try {\n        const res = await fetch(`${API.fullUrl}/landing/add-settings`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        })\n        const created = await this.parseResponse(res)\n        if (created) {\n          const idx = this.landings.findIndex(l => (l.id && created.id && l.id === created.id) || (l.uid && created.uid && l.uid === created.uid))\n          if (idx !== -1) this.landings.splice(idx, 1, created)\n          else this.landings.unshift(created)\n          this.landing = created\n        }\n        return created\n      } catch (err) {\n        this.error = err.message || 'Ошибка'\n        throw err\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async fetchLanding(id) {\n      if (!id) throw new Error('id обязателен')\n      this.loading = true\n      this.error = null\n      try {\n        const res = await fetch(`${API.fullUrl}/landing/landing/${id}`)\n        const data = await this.parseResponse(res)\n        this.landing = data\n        return data\n      } catch (err) {\n        this.error = err.message\n        throw err\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async fetchLandingByUid(uid) {\n      if (!uid) throw new Error('uid обязателен')\n      this.loading = true\n      this.error = null\n      try {\n        const res = await fetch(`${API.fullUrl}/landing/landing-uid/${uid}`)\n        const data = await this.parseResponse(res)\n        this.landing = data\n        return data\n      } catch (err) {\n        this.error = err.message\n        throw err\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async fetchAll() {\n      this.loading = true\n      this.error = null\n      try {\n        const res = await fetch(`${API.fullUrl}/landing/landings`)\n        const data = await this.parseResponse(res)\n        this.landings = Array.isArray(data) ? data : (data ? [data] : [])\n        return this.landings\n      } catch (err) {\n        this.error = err.message\n        throw err\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async updateLanding(id, payload) {\n      if (!id) throw new Error('id обязателен')\n      this.loading = true\n      this.error = null\n      try {\n        const res = await fetch(`${API.fullUrl}/landing/landing/${id}`, {\n          method: 'PUT',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        })\n        const updated = await this.parseResponse(res)\n        if (updated) {\n          const idx = this.landings.findIndex(l => l.id && updated.id && l.id === updated.id)\n          if (idx !== -1) this.landings.splice(idx, 1, updated)\n          this.landing = updated\n        }\n        return updated\n      } catch (err) {\n        this.error = err.message\n        throw err\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async deleteLanding(id) {\n      if (!id) throw new Error('id обязателен')\n      this.loading = true\n      this.error = null\n      try {\n        const res = await fetch(`${API.fullUrl}/landing/landing/${id}`, { method: 'DELETE' })\n        const deleted = await this.parseResponse(res)\n        const idx = this.landings.findIndex(l => l.id && l.id === Number(id) || (l.id && l.id === id))\n        if (idx !== -1) this.landings.splice(idx, 1)\n        if (this.landing && (this.landing.id === id || this.landing.id === Number(id))) this.landing = null\n        return deleted\n      } catch (err) {\n        this.error = err.message\n        throw err\n      } finally {\n        this.loading = false\n      }\n    }\n  }\n})","<template>\n  <div class=\"p-6 max-w-6xl mx-auto\">\n    <h2 class=\"text-2xl font-bold mb-6\">Управление страницами</h2>\n\n    <!-- Фильтр по дате -->\n    <div class=\"flex gap-4 mb-4\">\n      <div>\n        <label>С:</label>\n        <input type=\"date\" v-model=\"dateFrom\" class=\"border rounded p-2\" />\n      </div>\n      <div>\n        <label>По:</label>\n        <input type=\"date\" v-model=\"dateTo\" class=\"border rounded p-2\" />\n      </div>\n    </div>\n\n    <!-- Таблица CRUD -->\n    <div class=\"overflow-x-auto border rounded-lg mb-6\">\n      <table class=\"min-w-full divide-y divide-gray-200\">\n        <thead class=\"bg-gray-100\">\n          <tr>\n            <th class=\"px-4 py-2 text-left text-sm font-medium text-gray-700\">ID</th>\n            <th class=\"px-4 py-2 text-left text-sm font-medium text-gray-700\">UID</th>\n            <th class=\"px-4 py-2 text-left text-sm font-medium text-gray-700\">Название</th>\n            <th class=\"px-4 py-2 text-left text-sm font-medium text-gray-700\">Цвет фона</th>\n            <th class=\"px-4 py-2 text-left text-sm font-medium text-gray-700\">Логотип</th>\n            <th class=\"px-4 py-2 text-left text-sm font-medium text-gray-700\">Дата создания</th>\n            <th class=\"px-4 py-2 text-left text-sm font-medium text-gray-700\">Действия</th>\n          </tr>\n        </thead>\n        <tbody class=\"bg-white divide-y divide-gray-200\">\n          <tr v-for=\"landing in filteredLandings\" :key=\"landing.id\" class=\"hover:bg-gray-50\">\n            <td class=\"px-4 py-2 text-sm text-gray-700\">{{ landing.id }}</td>\n            <td class=\"px-4 py-2 text-sm text-gray-700\">{{ landing.uid }}</td>\n            <td class=\"px-4 py-2\">\n              <input v-model=\"landing.title\" class=\"border rounded px-2 py-1 w-full\" />\n            </td>\n            <td class=\"px-4 py-2\">\n              <input v-model=\"landing.bg_color\" type=\"color\" class=\"w-full h-8 border rounded p-1\" />\n            </td>\n            <td class=\"px-4 py-2\">\n              <input v-model=\"landing.logo\" class=\"border rounded px-2 py-1 w-full\" />\n            </td>\n            <td class=\"px-4 py-2 text-sm text-gray-700\">\n\t\t\t\t\t\t  {{ landing.dt_created ? new Date(landing.dt_created).toLocaleString() : '' }}\n\t\t\t\t\t\t</td>\n            <td class=\"px-4 py-2 space-x-2\">\n              <button @click=\"updateLanding(landing)\" class=\"bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600\">Сохранить</button>\n              <button @click=\"deleteLanding(landing.id)\" class=\"bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600\">Удалить</button>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n\n    <!-- Форма добавления новой записи -->\n    <h3 class=\"text-xl font-semibold mb-2\">Создать новую страницу</h3>\n    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\n      <input v-model=\"newLanding.title\" placeholder=\"Название\" class=\"border rounded p-2\" />\n      <input v-model=\"newLanding.bg_color\" type=\"color\" class=\"border rounded p-2\" />\n      <input v-model=\"newLanding.logo\" placeholder=\"URL логотипа\" class=\"border rounded p-2\" />\n      <input v-model=\"newLanding.user_uid\" placeholder=\"User UID\" class=\"border rounded p-2\" />\n    </div>\n    <button @click=\"addLanding\" class=\"bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600\">Создать</button>\n\n    <!-- Ошибки -->\n    <div v-if=\"error\" class=\"mt-4 text-red-600\">{{ error }}</div>\n  </div>\n</template>\n\n<script>\nimport { useLandingStore } from '~/stores/landing'\n\nexport default {\n  name: 'LandingTable',\n  data() {\n    return {\n      landings: [],\n      newLanding: {\n        uid: '',\n        bg_color: '#f5511e',\n        font: null,\n        logo: '',\n        user_uid: '',\n        title: '',\n        preview: null,\n        url: null,\n        url_preview: null\n      },\n      dateFrom: '',\n      dateTo: '',\n      error: null,\n    }\n  },\n  computed: {\n    filteredLandings() {\n      return this.landings.filter(l => {\n        if (!l.dt_created) return true\n        const created = new Date(l.dt_created)\n        const from = this.dateFrom ? new Date(this.dateFrom) : null\n        const to = this.dateTo ? new Date(this.dateTo) : null\n        if (from && created < from) return false\n        if (to && created > to) return false\n        return true\n      })\n    }\n  },\n  methods: {\n    async fetchAll() {\n      try {\n        const store = useLandingStore()\n        this.landings = await store.fetchAll()\n      } catch (err) {\n        this.error = err.message\n      }\n    },\n    async addLanding() {\n      try {\n        const store = useLandingStore()\n        const created = await store.addLandingSettings(this.newLanding)\n        const exists = this.landings.find(l => l.id === created.id)\n        if (!exists) this.landings.unshift(created)\n        this.newLanding = { uid: '', bg_color: '#f5511e', font: null, logo: '', user_uid: '', title: '', preview: null, url: null, url_preview: null }\n        this.error = null\n      } catch (err) {\n        this.error = err.message\n      }\n    },\n    async updateLanding(landing) {\n      try {\n        const store = useLandingStore()\n        await store.updateLanding(landing.id, landing)\n        this.error = null\n      } catch (err) {\n        this.error = err.message\n      }\n    },\n    async deleteLanding(id) {\n      try {\n        const store = useLandingStore()\n        await store.deleteLanding(id)\n        this.landings = this.landings.filter(l => l.id !== id)\n      } catch (err) {\n        this.error = err.message\n      }\n    }\n  },\n  mounted() {\n    this.fetchAll()\n  }\n}\n</script>\n\n<style scoped>\ntable {\n  border-collapse: collapse;\n}\nth, td {\n  text-align: left;\n}\ninput {\n  outline: none;\n}\nbutton {\n  cursor: pointer;\n}\n</style>\n"],"names":["_ssrRenderAttrs","_mergeProps","_ssrRenderList","_ssrInterpolate","_ssrRenderAttr"],"mappings":"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"}