{"file":"_id_-BISEckwS.js","mappings":"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","names":["_ssrRenderAttrs","_mergeProps","_ssrInterpolate","_ssrRenderAttr"],"sources":["../../../../pages/buy-template/[id].vue"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <div class=\"wrapper\">\n      <!-- LEFT: информация о шаблоне и доступные опции -->\n      <section class=\"card main\">\n        <h1 class=\"title\">Сайт \"{{ template.title }}\"</h1>\n        <div class=\"meta\">\n          <span class=\"price\">{{ formatCurrency(template.price) }}</span>\n        </div>\n\n        <div class=\"extras\">\n          <h3>Дополнительные опции</h3>\n\n          <label class=\"addon\">\n            <input type=\"checkbox\" v-model=\"addons.extraPage.enabled\" />\n            Доп. страница — {{ formatCurrency(addons.extraPage.price) }} / страница\n          </label>\n          <div v-if=\"addons.extraPage.enabled\" class=\"addon-ctrl\">\n            <label>Количество:\n              <input type=\"number\" min=\"0\" step=\"1\" v-model.number=\"addons.extraPage.count\" />\n            </label>\n          </div>\n\n          <label class=\"addon\">\n            <input type=\"checkbox\" v-model=\"addons.customization.enabled\" />\n            Кастомизация — {{ formatCurrency(addons.customization.pricePerHour) }} / час\n          </label>\n          <div v-if=\"addons.customization.enabled\" class=\"addon-ctrl\">\n            <label>Часы:\n              <input type=\"number\" min=\"0\" step=\"1\" v-model.number=\"addons.customization.hours\" />\n            </label>\n          </div>\n\n          <label class=\"addon\">\n            <input type=\"checkbox\" v-model=\"addons.priority.enabled\" />\n            Приоритетная доработка — {{ formatCurrency(addons.priority.price) }}\n          </label>\n\n          <label class=\"addon\">\n            <input type=\"checkbox\" v-model=\"addons.hosting.enabled\" />\n            Подключение и хостинг — {{ formatCurrency(addons.hosting.price) }}\n          </label>\n        </div>\n\n        <div class=\"preview-link\" v-if=\"template.preview\">\n          <a :href=\"template.preview\" target=\"_blank\" rel=\"noopener\">Открыть демо (preview)</a>\n        </div>\n      </section>\n\n      <!-- RIGHT: корзина / заказ -->\n      <aside class=\"card sidebar\">\n        <h2>Ваш заказ</h2>\n\n        <div class=\"order-lines\">\n          <div class=\"line\">\n            <span>Базовая цена</span>\n            <span>{{ formatCurrency(basePrice) }}</span>\n          </div>\n\n          <div class=\"line\" v-if=\"selectedPagesCount !== template.pages.length\">\n            <span>Выбранные страницы</span>\n            <span>{{ selectedPagesCount }} / {{ template.pages.length }}</span>\n          </div>\n\n          <div class=\"line\" v-if=\"addons.extraPage.enabled && addons.extraPage.count > 0\">\n            <span>Доп. страницы (x{{ addons.extraPage.count }})</span>\n            <span>{{ formatCurrency(extraPagesCost) }}</span>\n          </div>\n\n          <div class=\"line\" v-if=\"addons.customization.enabled && addons.customization.hours > 0\">\n            <span>Кастомизация ({{ addons.customization.hours }} ч)</span>\n            <span>{{ formatCurrency(customizationCost) }}</span>\n          </div>\n\n          <div class=\"line\" v-if=\"addons.priority.enabled\">\n            <span>Приоритет</span>\n            <span>{{ formatCurrency(addons.priority.price) }}</span>\n          </div>\n\n          <div class=\"line\" v-if=\"addons.hosting.enabled\">\n            <span>Подключение / хостинг</span>\n            <span>{{ formatCurrency(addons.hosting.price) }}</span>\n          </div>\n\n          <hr />\n\n          <div class=\"line\">\n            <strong>Промежуточная сумма</strong>\n            <strong>{{ formatCurrency(subtotal) }}</strong>\n          </div>\n\n          <div class=\"line discount\" v-if=\"appliedDiscount > 0\">\n            <span>Скидка {{ discountLabel }}</span>\n            <span>-{{ formatCurrency(appliedDiscount) }}</span>\n          </div>\n\n          <div class=\"line total\">\n            <strong>Итого</strong>\n            <strong>{{ formatCurrency(total) }}</strong>\n          </div>\n        </div>\n\n        <div class=\"order-actions\">\n          <label class=\"input\">\n            Имя:\n            <input v-model=\"buyer.name\" placeholder=\"Иван Иванов\" />\n          </label>\n          <label class=\"input\">\n            Телефон / email:\n            <input v-model=\"buyer.contact\" placeholder=\"+7 900 000-00-00 или email@example.com\" />\n          </label>\n\n          <button class=\"btn primary\" :disabled=\"placing\" @click=\"placeOrder\">\n            {{ placing ? 'Оформление…' : 'Оформить заказ' }}\n          </button>\n\n          <button class=\"btn ghost\" @click=\"resetSelections\">Сбросить</button>\n\n          <div class=\"note\">\n            <small>Нажимая «Оформить заказ», вы отправляете заявку. Реальная интеграция с оплатой/бекендом не включена в этот пример.</small>\n          </div>\n        </div>\n      </aside>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { onMounted, ref, computed, watchEffect } from 'vue'\nimport { useRoute } from 'vue-router'\nimport { useTemplateStore } from '~/stores/template'\n\nconst route = useRoute()\nconst store = useTemplateStore()\nconst id = route.params.id\n\nonMounted(async () => {\n  if (id) {\n    try {\n      await store.getTemplateById(id)\n    } catch (e) {\n      // error stored in store\n    }\n  }\n})\n\nconst template = computed(() => store.current || {\n  id: null, title: '', price: 0, image: '', description: '', features: [], pages: [], technologies: [], screenshots: [], preview: '', discount_percent: 0, discount_amount: 0\n})\n\nconst basePrice = computed(() => Number(template.value.price || 0))\n\nconst addons = ref({\n  extraPage: { enabled: false, price: 1000, count: 0 },\n  customization: { enabled: false, pricePerHour: 500, hours: 0 },\n  priority: { enabled: false, price: 2000 },\n  hosting: { enabled: false, price: 1000 }\n})\n\nconst selectedPages = ref([])\n\nonMounted(() => {\n  if (template.value.pages && template.value.pages.length) {\n    selectedPages.value = [...template.value.pages]\n  }\n})\n\nwatchEffect(() => {\n  if (template.value.pages && selectedPages.value.length === 0) {\n    selectedPages.value = [...template.value.pages]\n  }\n})\n\nconst buyer = ref({ name: '', contact: '' })\nconst placing = ref(false)\n\nconst selectedPagesCount = computed(() => selectedPages.value.length)\n\nconst extraPagesCost = computed(() => {\n  const c = Number(addons.value.extraPage.count || 0)\n  const price = Number(addons.value.extraPage.price || 0)\n  return (addons.value.extraPage.enabled && c > 0) ? (c * price) : 0\n})\n\nconst customizationCost = computed(() => {\n  const h = Number(addons.value.customization.hours || 0)\n  const rate = Number(addons.value.customization.pricePerHour || 0)\n  return (addons.value.customization.enabled && h > 0) ? (h * rate) : 0\n})\n\nconst priorityCost = computed(() => addons.value.priority.enabled ? Number(addons.value.priority.price || 0) : 0)\nconst hostingCost = computed(() => addons.value.hosting.enabled ? Number(addons.value.hosting.price || 0) : 0)\n\nconst subtotal = computed(() => {\n  const parts = [\n    basePrice.value,\n    extraPagesCost.value,\n    customizationCost.value,\n    priorityCost.value,\n    hostingCost.value\n  ]\n  return parts.reduce((acc, v) => acc + Number(v || 0), 0)\n})\n\nconst appliedDiscount = computed(() => {\n  const discAmount = Number(template.value.discount_amount || 0)\n  const discPercent = Number(template.value.discount_percent || 0)\n\n  if (discAmount > 0) return Math.min(discAmount, subtotal.value)\n  if (discPercent > 0) return Math.min(Math.round((subtotal.value * discPercent) / 100), subtotal.value)\n  return 0\n})\n\nconst discountLabel = computed(() => {\n  const discAmount = Number(template.value.discount_amount || 0)\n  const discPercent = Number(template.value.discount_percent || 0)\n  if (discAmount > 0) return `${formatCurrency(discAmount)}`\n  if (discPercent > 0) return `${discPercent}%`\n  return ''\n})\n\nconst total = computed(() => {\n  const t = subtotal.value - appliedDiscount.value\n  return t > 0 ? t : 0\n})\n\nfunction formatCurrency(value) {\n  try {\n    const v = Number(value || 0)\n    return new Intl.NumberFormat('ru-RU', { style: 'currency', currency: 'RUB', maximumFractionDigits: 0 }).format(Math.round(v))\n  } catch (e) {\n    return `${value} ₽`\n  }\n}\n\nfunction resetSelections() {\n  addons.value.extraPage.enabled = false\n  addons.value.extraPage.count = 0\n  addons.value.customization.enabled = false\n  addons.value.customization.hours = 0\n  addons.value.priority.enabled = false\n  addons.value.hosting.enabled = false\n  selectedPages.value = template.value.pages ? [...template.value.pages] : []\n  buyer.value = { name: '', contact: '' }\n}\n\nasync function placeOrder() {\n  if (!buyer.value.name || !buyer.value.contact) {\n    alert('Укажите имя и контакт для оформления заказа.')\n    return\n  }\n\n  placing.value = true\n  try {\n    const order = {\n      templateId: template.value.id,\n      templateTitle: template.value.title,\n      basePrice: basePrice.value,\n      extras: {\n        extraPages: addons.value.extraPage.enabled ? { count: addons.value.extraPage.count, unitPrice: addons.value.extraPage.price } : null,\n        customization: addons.value.customization.enabled ? { hours: addons.value.customization.hours, rate: addons.value.customization.pricePerHour } : null,\n        priority: addons.value.priority.enabled ? { price: addons.value.priority.price } : null,\n        hosting: addons.value.hosting.enabled ? { price: addons.value.hosting.price } : null\n      },\n      subtotal: subtotal.value,\n      discount: appliedDiscount.value,\n      total: total.value,\n      buyer: buyer.value,\n      selectedPages: selectedPages.value,\n      created_at: new Date().toISOString()\n    }\n\n    console.log('ORDER', order)\n    alert('Заявка отправлена!\\nИтог: ' + formatCurrency(total.value))\n    resetSelections()\n  } catch (e) {\n    console.error(e)\n    alert('Ошибка при оформлении заказа')\n  } finally {\n    placing.value = false\n  }\n}\n</script>\n\n<style scoped>\n/* Общие */\n.container {\n  padding: 1rem;\n  min-height: 100vh;\n  display: flex;\n  justify-content: center;\n  background-color: #f8f9fb;\n}\n\n/* Обёртка с колонками */\n.wrapper {\n  width: 100%;\n  display: flex;\n  gap: 1.25rem; /* ~20px */\n  align-items: flex-start;\n  padding: 0.5rem;\n}\n\n/* Карточка */\n.card {\n  background: #ffffff;\n  border: 0.0625rem solid #ececec;\n  padding: 1rem;\n  border-radius: 0.5rem;\n  box-shadow: 0 0.125rem 0.375rem rgba(0,0,0,0.04);\n}\n\n/* Основная колонка и сайдбар */\n.main { flex: 1 1 40rem; min-width: 0; }\n.sidebar { flex: 0 0 26rem; min-width: 18rem; max-height: calc(100vh - 4rem); overflow: auto; position: sticky; top: 1rem; }\n\n/* Типографика */\n.title { font-size: 1.25rem; margin: 0.75rem 0; line-height: 1.2; }\n.meta { display:flex; justify-content:space-between; gap:0.75rem; color:#666666; margin-bottom:0.625rem; }\n.price { font-weight:700; color:#111111; font-size:1rem; }\n\n/* Блоки опций */\n.extras { margin-top: 1rem; }\n.addon { display:block; margin:0.5rem 0; font-size:0.95rem; }\n.addon-ctrl { margin:0.375rem 0 0.75rem 1.25rem; }\n\n/* Ссылки превью */\n.preview-link { margin-top: 1rem; }\n.preview-link a { font-size: 0.95rem; color: #0070f3; text-decoration: none; }\n\n/* Корзина / линии */\n.order-lines .line { display:flex; justify-content:space-between; align-items:center; padding:0.375rem 0; font-size:0.95rem; }\n.order-lines hr { border: none; border-top: 0.0625rem solid #ececec; margin: 0.625rem 0; }\n.total { font-size: 1.125rem; }\n\n/* Формы и кнопки */\n.input { display:block; margin:0.625rem 0; font-size:0.95rem; }\n.input input { width:100%; padding:0.5rem 0.625rem; border:0.0625rem solid #dddddd; border-radius:0.375rem; font-size:1rem; }\n\n.order-actions { margin-top: 0.875rem; display:flex; flex-direction:column; gap:0.5rem; }\n.btn { display:inline-flex; align-items:center; justify-content:center; padding:0.625rem 0.875rem; border-radius:0.5rem; border:none; cursor:pointer; font-size:1rem; }\n.btn.primary { background:#0070f3; color:#fff; box-shadow: 0 0.125rem 0.375rem rgba(0,112,243,0.12); }\n.btn.primary:disabled { opacity:0.6; cursor:not-allowed; }\n.btn.ghost { background:transparent; border:0.0625rem solid #dddddd; }\n\n/* Примечание */\n.note { margin-top:0.75rem; color:#666666; font-size:0.875rem; }\n\n/* Фокус для доступности */\ninput:focus, button:focus, a:focus { outline: 0.1875rem solid rgba(0,112,243,0.12); outline-offset: 0.125rem; }\n\n/* Адаптив */\n@media (max-width: 64rem) {\n  .sidebar { flex: 0 0 22rem; }\n}\n\n@media (max-width: 48rem) {\n  .wrapper { flex-direction: column; gap: 0.875rem; align-items: stretch; }\n  .sidebar { position: relative; top: 0; flex: 1 1 auto; max-height: none; min-width: 0; }\n  .main { flex: 1 1 auto; }\n  .btn { padding: 0.75rem 0.875rem; font-size: 1.05rem; }\n  .input input { padding: 0.625rem 0.75rem; }\n}\n\n@media (max-width: 32rem) {\n  .title { font-size: 1.125rem; }\n}\n\n/* Печать */\n@media print {\n  .sidebar { position: static; max-height: none; }\n  .btn, input { box-shadow: none; outline: none; }\n  .container { background: #fff; padding: 0; }\n}\n</style>\n"],"version":3}